import{j as ee,d as te,r as _,k as x,m as ae,c as g,h as t,b as a,w as n,t as b,K as se,e as d,X as le,x as o,E as U,o as m,i as p,U as oe,G as $,Q as ne,R as ie,J as de,P as re,q as L,a3 as ue,V as ce,a4 as ve,_ as pe}from"./index-DSeUM942.js";const _e=(M=1,f=20,c)=>ee.get("/logs",{params:{page:M,size:f,...c}}),ge={class:"page"},me={class:"page-header"},fe={class:"header-actions"},ye={class:"stats-grid"},he={class:"stat-card",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},be={class:"value"},ke={class:"stat-card",style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"}},we={class:"value"},Ce={class:"stat-card",style:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"}},Ve={class:"value"},De={class:"stat-card",style:{background:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"}},ze={class:"value"},xe={class:"filter-form"},Ue={class:"table-header"},Le={class:"table-count"},Me={class:"logs-container"},Se={key:0,class:"empty-state"},Ye={key:1,class:"logs-list"},Ae=["onClick"],Re={class:"log-avatar"},Te={class:"log-content"},Ne={class:"log-header"},$e={class:"log-username"},He={class:"log-time"},Pe={key:0,class:"log-detail"},qe={class:"log-footer"},Be={class:"log-ip"},Ee={class:"log-actions"},Ke={key:0,class:"log-detail-content"},je={class:"detail-item"},Fe={class:"detail-value"},Ie={class:"detail-item"},Ge={class:"detail-value"},Je={class:"detail-item"},Qe={class:"detail-value"},Xe={class:"detail-item"},Oe={class:"detail-value"},We={key:0,class:"detail-item"},Ze={class:"detail-value"},et=te({__name:"LogsView",setup(M){const f=_([]),c=_(1),k=_(20),C=_(0),V=_(!1),D=_(!1),z=_(!1),r=_(null),u=_({keyword:"",action:"",dateRange:void 0}),H=x(()=>{const l=new Date().toDateString();return f.value.filter(e=>new Date(e.createdAt).toDateString()===l).length}),P=x(()=>new Set(f.value.map(e=>e.username)).size),q=x(()=>f.value.filter(l=>{var e,i;return l.action==="删除"||((e=l.detail)==null?void 0:e.includes("失败"))||((i=l.detail)==null?void 0:i.includes("错误"))}).length),h=async()=>{var l,e;V.value=!0;try{const i={page:c.value,size:k.value,keyword:u.value.keyword,action:u.value.action,startDate:(l=u.value.dateRange)==null?void 0:l[0],endDate:(e=u.value.dateRange)==null?void 0:e[1]},v=await _e(c.value,k.value,i);f.value=v.records,C.value=v.total}catch{U.error("加载日志失败")}finally{V.value=!1}},B=l=>{k.value=l,c.value=1,h()},E=l=>{c.value=l,h()},w=()=>{c.value=1,h()},K=()=>{u.value={keyword:"",action:"",dateRange:void 0},c.value=1,h()},S=l=>({登录:"success",登出:"info",新增:"primary",修改:"warning",删除:"danger",查询:"",导出:"success"})[l]||"",j=l=>{const e=new Date(l),v=new Date().getTime()-e.getTime();return v<6e4?"刚刚":v<36e5?`${Math.floor(v/6e4)}分钟前`:v<864e5?`${Math.floor(v/36e5)}小时前`:e.toLocaleString("zh-CN")},Y=l=>`https://api.dicebear.com/7.x/avataaars/svg?seed=${l}`,A=l=>{r.value=l,z.value=!0},F=async()=>{D.value=!0;try{U.success("日志导出功能开发中...")}catch{U.error("导出失败")}finally{D.value=!1}};return ae(()=>{h()}),(l,e)=>{const i=d("el-button"),v=d("el-input"),y=d("el-option"),I=d("el-select"),G=d("el-date-picker"),R=d("el-card"),J=d("el-empty"),T=d("el-avatar"),N=d("el-tag"),Q=d("el-icon"),X=d("el-pagination"),O=d("el-dialog"),W=ie("loading");return m(),g("div",ge,[t("div",me,[e[8]||(e[8]=t("div",null,[t("h2",null,"操作日志"),t("p",{class:"sub"},"系统操作审计记录，实时追踪所有用户行为")],-1)),t("div",fe,[a(i,{type:"primary",icon:b(se),onClick:F,loading:D.value},{default:n(()=>[...e[6]||(e[6]=[p(" 导出日志 ",-1)])]),_:1},8,["icon","loading"]),a(i,{icon:b(le),onClick:h,loading:V.value},{default:n(()=>[...e[7]||(e[7]=[p(" 刷新 ",-1)])]),_:1},8,["icon","loading"])])]),t("div",ye,[t("div",he,[e[9]||(e[9]=t("p",{class:"label"},"今日日志",-1)),t("p",be,o(H.value),1)]),t("div",ke,[e[10]||(e[10]=t("p",{class:"label"},"活跃用户",-1)),t("p",we,o(P.value),1)]),t("div",Ce,[e[11]||(e[11]=t("p",{class:"label"},"总记录数",-1)),t("p",Ve,o(C.value),1)]),t("div",De,[e[12]||(e[12]=t("p",{class:"label"},"异常操作",-1)),t("p",ze,o(q.value),1)])]),a(R,{class:"filter-card"},{default:n(()=>[t("div",xe,[a(v,{modelValue:u.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value.keyword=s),placeholder:"搜索用户名、操作或详情","prefix-icon":b($),clearable:"",onClear:w,onKeyup:oe(w,["enter"])},null,8,["modelValue","prefix-icon"]),a(I,{modelValue:u.value.action,"onUpdate:modelValue":e[1]||(e[1]=s=>u.value.action=s),placeholder:"操作类型",clearable:"",onChange:w},{default:n(()=>[a(y,{label:"登录",value:"登录"}),a(y,{label:"登出",value:"登出"}),a(y,{label:"新增",value:"新增"}),a(y,{label:"修改",value:"修改"}),a(y,{label:"删除",value:"删除"}),a(y,{label:"查询",value:"查询"}),a(y,{label:"导出",value:"导出"})]),_:1},8,["modelValue"]),a(G,{modelValue:u.value.dateRange,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.dateRange=s),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",onChange:w},null,8,["modelValue"]),a(i,{type:"primary",icon:b($),onClick:w},{default:n(()=>[...e[13]||(e[13]=[p(" 搜索 ",-1)])]),_:1},8,["icon"]),a(i,{onClick:K},{default:n(()=>[...e[14]||(e[14]=[p("重置",-1)])]),_:1})])]),_:1}),a(R,{class:"table-card"},{default:n(()=>[t("div",Ue,[e[15]||(e[15]=t("span",{class:"table-title"},"日志记录",-1)),t("span",Le,"共 "+o(C.value)+" 条记录",1)]),ne((m(),g("div",Me,[f.value.length===0?(m(),g("div",Se,[a(J,{description:"暂无日志记录"})])):(m(),g("div",Ye,[(m(!0),g(de,null,re(f.value,s=>(m(),g("div",{key:s.id,class:"log-item",onClick:Z=>A(s)},[t("div",Re,[a(T,{size:40,src:Y(s.username)},{default:n(()=>[p(o(s.username.charAt(0).toUpperCase()),1)]),_:2},1032,["src"])]),t("div",Te,[t("div",Ne,[t("span",$e,o(s.username),1),a(N,{type:S(s.action),size:"small"},{default:n(()=>[p(o(s.action),1)]),_:2},1032,["type"]),t("span",He,o(j(s.createdAt)),1)]),s.detail?(m(),g("div",Pe,o(s.detail),1)):L("",!0),t("div",qe,[t("span",Be,[a(Q,null,{default:n(()=>[a(b(ue))]),_:1}),p(" "+o(s.ip),1)])])]),t("div",Ee,[a(i,{type:"text",size:"small",icon:b(ve),onClick:ce(Z=>A(s),["stop"])},{default:n(()=>[...e[16]||(e[16]=[p(" 详情 ",-1)])]),_:1},8,["icon","onClick"])])],8,Ae))),128))]))])),[[W,V.value]]),a(X,{"current-page":c.value,"onUpdate:currentPage":e[3]||(e[3]=s=>c.value=s),"page-size":k.value,"onUpdate:pageSize":e[4]||(e[4]=s=>k.value=s),total:C.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",class:"pagination",onSizeChange:B,onCurrentChange:E},null,8,["current-page","page-size","total"])]),_:1}),a(O,{modelValue:z.value,"onUpdate:modelValue":e[5]||(e[5]=s=>z.value=s),title:"日志详情",width:"600px","destroy-on-close":!0},{default:n(()=>[r.value?(m(),g("div",Ke,[t("div",je,[e[17]||(e[17]=t("label",null,"操作用户：",-1)),t("div",Fe,[a(T,{size:30,src:Y(r.value.username)},{default:n(()=>[p(o(r.value.username.charAt(0).toUpperCase()),1)]),_:1},8,["src"]),t("span",null,o(r.value.username),1)])]),t("div",Ie,[e[18]||(e[18]=t("label",null,"操作类型：",-1)),t("div",Ge,[a(N,{type:S(r.value.action)},{default:n(()=>[p(o(r.value.action),1)]),_:1},8,["type"])])]),t("div",Je,[e[19]||(e[19]=t("label",null,"操作时间：",-1)),t("div",Qe,o(r.value.createdAt),1)]),t("div",Xe,[e[20]||(e[20]=t("label",null,"IP地址：",-1)),t("div",Oe,o(r.value.ip||"未知"),1)]),r.value.detail?(m(),g("div",We,[e[21]||(e[21]=t("label",null,"操作详情：",-1)),t("div",Ze,[t("pre",null,o(r.value.detail),1)])])):L("",!0)])):L("",!0)]),_:1},8,["modelValue"])])}}}),at=pe(et,[["__scopeId","data-v-26954a61"]]);export{at as default};
