import{d as J,r as p,a as S,n as C,c as U,h as m,b as t,w as o,e as r,E as D,o as w,i as v,t as Q,X,J as q,P as G,p as A,Q as K,R as W,x as R,_ as ee}from"./index-DVwYDEL5.js";import{c as ae}from"./submissions-DVKte-tD.js";import{l as te}from"./users-iWmjUf7j.js";const ne={class:"page"},le={class:"page-header"},oe={class:"header-actions"},se={class:"log-content"},re=J({__name:"SubmissionLogsView",setup(ie){const y=p(!1),h=p(!1),k=p(!1),g=p([]),V=p([]),n=S({username:"",keyword:"",range:[]}),s=S({page:1,size:10,total:0}),f=p(!1),T=()=>{var e,u;const a={page:s.page,size:s.size,username:((e=n.username)==null?void 0:e.trim())||void 0,keyword:((u=n.keyword)==null?void 0:u.trim())||void 0};return Array.isArray(n.range)&&n.range.length===2&&(a.startTime=n.range[0],a.endTime=n.range[1]),a},j=async()=>{h.value=!0;try{const a=await te();V.value=a.map(e=>e.username)}finally{h.value=!1}},d=async()=>{y.value=!0;try{const a=await ae(T());g.value=a.records,s.total=a.total}catch(a){console.error(a),D.error("加载提交记录失败")}finally{y.value=!1}},B=()=>{f.value=!0,n.username="",n.keyword="",n.range=[],s.page=1,f.value=!1,d()},E=a=>{s.page=a,d()},O=a=>{s.size=a,s.page=1,d()},N=()=>{d()},P=async()=>{if(!g.value.length){D.warning("暂无数据可导出");return}k.value=!0;try{const a=["提交时间","用户名","原文本"],e=g.value.map(i=>[i.createdAt??"",i.username??"",i.content??""]),u=[a,...e].map(i=>i.map(x=>`"${String(x??"").replace(/"/g,'""')}"`).join(",")).join(`
`),c=new Blob([u],{type:"application/vnd.ms-excel"}),b=window.URL.createObjectURL(c),_=document.createElement("a");_.href=b,_.download=`submission-logs-${new Date().toISOString().slice(0,10)}.xls`,_.click(),window.URL.revokeObjectURL(b)}finally{k.value=!1}};C(()=>n.username,a=>{f.value||(s.page=1,d())}),C(()=>n.range,()=>{f.value||(s.page=1,d())},{deep:!0}),C(()=>n.keyword,a=>{f.value||(s.page=1,d())});const Y=a=>{if(!a)return"-";const e=new Date(a.replace("T"," ").replace("Z",""));return new Intl.DateTimeFormat("zh-CN",{timeZone:"Asia/Shanghai",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(e).replace(/\//g,"-")},F=a=>a?a.replace(/\u00A0/g," ").replace(/\u3000/g," ").split(/\r?\n/).map(e=>e.trim()).filter(e=>e.length>0).join(`
`):"";return j(),d(),(a,e)=>{const u=r("el-icon"),c=r("el-button"),b=r("el-option"),_=r("el-select"),i=r("el-form-item"),x=r("el-input"),I=r("el-date-picker"),M=r("el-form"),L=r("el-card"),z=r("el-table-column"),H=r("el-table"),Z=r("el-pagination"),$=W("loading");return w(),U("div",ne,[m("div",le,[e[7]||(e[7]=m("div",null,[m("h2",null,"提交记录"),m("p",{class:"sub"},"查看用户提交的原始文本与时间")],-1)),m("div",oe,[t(c,{text:"",onClick:N},{default:o(()=>[t(u,null,{default:o(()=>[t(Q(X))]),_:1}),e[5]||(e[5]=v("刷新 ",-1))]),_:1}),t(c,{text:"",loading:k.value,disabled:!g.value.length,onClick:P},{default:o(()=>[...e[6]||(e[6]=[v(" 导出 Excel ",-1)])]),_:1},8,["loading","disabled"])])]),t(L,{class:"filter-card"},{default:o(()=>[t(M,{inline:!0,model:n},{default:o(()=>[t(i,{label:"用户名"},{default:o(()=>[t(_,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=l=>n.username=l),filterable:"",clearable:"",placeholder:"全部用户",style:{width:"200px"},loading:h.value},{default:o(()=>[(w(!0),U(q,null,G(V.value,l=>(w(),A(b,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),t(i,{label:"关键字"},{default:o(()=>[t(x,{modelValue:n.keyword,"onUpdate:modelValue":e[1]||(e[1]=l=>n.keyword=l),placeholder:"搜索原文",clearable:""},null,8,["modelValue"])]),_:1}),t(i,{label:"时间范围"},{default:o(()=>[t(I,{modelValue:n.range,"onUpdate:modelValue":e[2]||(e[2]=l=>n.range=l),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD HH:mm:ss","unlink-panels":""},null,8,["modelValue"])]),_:1}),t(i,null,{default:o(()=>[t(c,{type:"primary",onClick:d},{default:o(()=>[...e[8]||(e[8]=[v("查询",-1)])]),_:1}),t(c,{onClick:B},{default:o(()=>[...e[9]||(e[9]=[v("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(L,{class:"table-card"},{default:o(()=>[K((w(),A(H,{data:g.value},{default:o(()=>[t(z,{prop:"createdAt",label:"提交时间",width:"200"},{default:o(({row:l})=>[v(R(Y(l.createdAt)),1)]),_:1}),t(z,{prop:"username",label:"用户名",width:"160"}),t(z,{label:"原文本"},{default:o(({row:l})=>[m("span",se,R(F(l.content)),1)]),_:1})]),_:1},8,["data"])),[[$,y.value]]),t(Z,{"current-page":s.page,"onUpdate:currentPage":e[3]||(e[3]=l=>s.page=l),"page-size":s.size,"onUpdate:pageSize":e[4]||(e[4]=l=>s.size=l),total:s.total,layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],class:"table-pagination",background:"",onSizeChange:O,onCurrentChange:E},null,8,["current-page","page-size","total"])]),_:1})])}}}),pe=ee(re,[["__scopeId","data-v-fcf92a69"]]);export{pe as default};
