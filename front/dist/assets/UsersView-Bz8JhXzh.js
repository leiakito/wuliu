import{l as q,u as O,c as P,r as z,d as F}from"./users-B9v59k8P.js";import{d as G,r as p,a as H,j as J,c as K,e as c,b as l,w as a,g as r,f as n,v as Q,x as W,m as E,t as X,n as Y,E as V,C as B,o as y}from"./index-xnLysfLr.js";const Z={class:"page"},h={class:"page-header"},te=G({__name:"UsersView",setup(ee){const k=p([]),v=p(!1),_=p(!1),i=p(!1),g=p(),t=H({username:"",fullName:"",role:"USER",status:"ENABLED",password:""}),D=J(()=>t.id?"编辑用户":"新增用户"),x={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},b=async()=>{v.value=!0;try{k.value=await q()}finally{v.value=!1}},N=s=>{s?Object.assign(t,s,{password:"",id:s.id}):Object.assign(t,{id:void 0,username:"",fullName:"",role:"USER",status:"ENABLED",password:""}),i.value=!0},A=async()=>{if(!(!g.value||!await g.value.validate().catch(()=>!1))){_.value=!0;try{t.id?await O(t.id,t):await P(t),V.success("保存成功"),i.value=!1,b()}finally{_.value=!1}}},$=async s=>{const{value:e}=await B.prompt(`为 ${s.username} 设置新密码`,"重置密码",{inputType:"password",confirmButtonText:"确定",cancelButtonText:"取消"});await z(s.id,e),V.success("密码已重置")},M=async s=>{await B.confirm(`确认删除 ${s.username} ?`,"提示",{type:"warning"}),await F(s.id),V.success("已删除"),b()};return b(),(s,e)=>{const d=n("el-button"),u=n("el-table-column"),R=n("el-tag"),S=n("el-table"),T=n("el-card"),w=n("el-input"),m=n("el-form-item"),f=n("el-option"),U=n("el-select"),I=n("el-form"),L=n("el-dialog"),j=W("loading");return y(),K("div",Z,[c("div",h,[e[9]||(e[9]=c("div",null,[c("h2",null,"用户管理"),c("p",{class:"sub"},"仅管理员可访问，支持增删改及重置密码")],-1)),l(d,{type:"primary",onClick:e[0]||(e[0]=o=>N())},{default:a(()=>[...e[8]||(e[8]=[r("新增用户",-1)])]),_:1})]),l(T,{class:"table-card"},{default:a(()=>[Q((y(),E(S,{data:k.value},{default:a(()=>[l(u,{prop:"username",label:"用户名",width:"160"}),l(u,{prop:"fullName",label:"姓名",width:"160"}),l(u,{label:"角色",width:"140"},{default:a(({row:o})=>[l(R,{type:o.role==="ADMIN"?"danger":"info"},{default:a(()=>[r(X(o.role==="ADMIN"?"管理员":"用户"),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"status",label:"状态",width:"120"}),l(u,{prop:"createdAt",label:"创建时间"}),l(u,{label:"操作",width:"240"},{default:a(({row:o})=>[l(d,{link:"",type:"primary",onClick:C=>N(o)},{default:a(()=>[...e[10]||(e[10]=[r("编辑",-1)])]),_:1},8,["onClick"]),l(d,{link:"",type:"warning",onClick:C=>$(o)},{default:a(()=>[...e[11]||(e[11]=[r("重置密码",-1)])]),_:1},8,["onClick"]),l(d,{link:"",type:"danger",onClick:C=>M(o)},{default:a(()=>[...e[12]||(e[12]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,v.value]])]),_:1}),l(L,{modelValue:i.value,"onUpdate:modelValue":e[7]||(e[7]=o=>i.value=o),title:D.value,width:"520px"},{footer:a(()=>[l(d,{onClick:e[6]||(e[6]=o=>i.value=!1)},{default:a(()=>[...e[13]||(e[13]=[r("取消",-1)])]),_:1}),l(d,{type:"primary",loading:_.value,onClick:A},{default:a(()=>[...e[14]||(e[14]=[r("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(I,{ref_key:"formRef",ref:g,model:t,rules:x,"label-width":"80px"},{default:a(()=>[l(m,{label:"用户名",prop:"username"},{default:a(()=>[l(w,{modelValue:t.username,"onUpdate:modelValue":e[1]||(e[1]=o=>t.username=o),disabled:!!t.id},null,8,["modelValue","disabled"])]),_:1}),l(m,{label:"姓名",prop:"fullName"},{default:a(()=>[l(w,{modelValue:t.fullName,"onUpdate:modelValue":e[2]||(e[2]=o=>t.fullName=o)},null,8,["modelValue"])]),_:1}),l(m,{label:"角色",prop:"role"},{default:a(()=>[l(U,{modelValue:t.role,"onUpdate:modelValue":e[3]||(e[3]=o=>t.role=o)},{default:a(()=>[l(f,{label:"管理员",value:"ADMIN"}),l(f,{label:"用户",value:"USER"})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"状态",prop:"status"},{default:a(()=>[l(U,{modelValue:t.status,"onUpdate:modelValue":e[4]||(e[4]=o=>t.status=o)},{default:a(()=>[l(f,{label:"启用",value:"ENABLED"}),l(f,{label:"禁用",value:"DISABLED"})]),_:1},8,["modelValue"])]),_:1}),t.id?Y("",!0):(y(),E(m,{key:0,label:"初始密码",prop:"password"},{default:a(()=>[l(w,{modelValue:t.password,"onUpdate:modelValue":e[5]||(e[5]=o=>t.password=o),placeholder:"默认 ChangeMe123!"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{te as default};
