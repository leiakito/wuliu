import{y as _,d as W,u as X,j as D,a as H,r as C,c as N,h as g,b as t,n as F,w as o,e as i,o as c,i as m,F as Z,s as h,m as P,v as ee,x as te,t as ae,E as U,z as le,_ as re}from"./index-CbheMMSM.js";const oe=s=>_.get("/hardware/prices",{params:s}),ne=s=>_.post("/hardware/prices",s),ie=(s,y)=>_.put(`/hardware/prices/${s}`,y),se=s=>_.delete(`/hardware/prices/${s}`),de={class:"page"},me={class:"page-header"},ue={key:0,class:"actions"},pe=W({__name:"HardwarePricesView",setup(s){const y=X(),x=D(()=>{var a;return((a=y.user)==null?void 0:a.role)==="ADMIN"}),n=H({range:[],category:""}),v=C([]),b=C(!1),l=H({visible:!1,loading:!1,editingId:0,form:{priceDate:"",itemName:"",category:"",price:0,remark:""}}),w=C(),S={priceDate:[{required:!0,message:"请选择日期",trigger:"change"}],itemName:[{required:!0,message:"请输入名称",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"change"}]},A=D(()=>Array.from(new Set(v.value.map(a=>a.category).filter(a=>!!a)))),E=D(()=>v.value),O=()=>{const a=new Date,e=new Date;return e.setDate(a.getDate()-6),[V(e),V(a)]},V=a=>a.toISOString().slice(0,10),f=async()=>{b.value=!0;try{const a={};n.range.length===2&&(a.startDate=n.range[0],a.endDate=n.range[1]),n.category&&(a.category=n.category),v.value=await oe(a)}finally{b.value=!1}},I=()=>{n.range=O(),n.category="",f()},Y=a=>{a?(l.editingId=a.id,Object.assign(l.form,{priceDate:a.priceDate,itemName:a.itemName,category:a.category??"",price:a.price,remark:a.remark??""})):(l.editingId=0,Object.assign(l.form,{priceDate:n.range[1]||V(new Date),itemName:"",category:n.category||"",price:0,remark:""})),l.visible=!0},j=async()=>{if(!(!w.value||!await w.value.validate().catch(()=>!1))){l.loading=!0;try{l.editingId?(await ie(l.editingId,l.form),U.success("更新成功")):(await ne(l.form),U.success("新增成功")),l.visible=!1,f()}finally{l.loading=!1}}},q=async a=>{await le.confirm(`确认删除 ${a.itemName} 的报价吗？`,"提示",{type:"warning"}),await se(a.id),U.success("已删除"),f()},R=a=>(a??0).toFixed(2);return I(),(a,e)=>{const u=i("el-button"),M=i("el-date-picker"),d=i("el-form-item"),G=i("el-option"),z=i("el-select"),$=i("el-form"),B=i("el-card"),p=i("el-table-column"),K=i("el-table"),k=i("el-input"),L=i("el-input-number"),T=i("el-dialog"),J=te("loading");return c(),N("div",de,[g("div",me,[e[11]||(e[11]=g("div",null,[g("h2",null,"硬件价格"),g("p",{class:"sub"},"按日期记录 CPU / 主板 / GPU 等硬件价格")],-1)),x.value?(c(),N("div",ue,[t(u,{type:"primary",onClick:e[0]||(e[0]=r=>Y())},{default:o(()=>[...e[10]||(e[10]=[m("新增价格",-1)])]),_:1})])):F("",!0)]),t(B,null,{default:o(()=>[t($,{inline:!0,model:n,class:"filter-form"},{default:o(()=>[t(d,{label:"日期"},{default:o(()=>[t(M,{modelValue:n.range,"onUpdate:modelValue":e[1]||(e[1]=r=>n.range=r),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD","unlink-panels":""},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(u,{type:"primary",onClick:f},{default:o(()=>[...e[12]||(e[12]=[m("查询",-1)])]),_:1}),t(u,{onClick:I},{default:o(()=>[...e[13]||(e[13]=[m("最近 7 天",-1)])]),_:1})]),_:1}),t(d,{label:"分类"},{default:o(()=>[t(z,{modelValue:n.category,"onUpdate:modelValue":e[2]||(e[2]=r=>n.category=r),placeholder:"全部",clearable:"",filterable:"",style:{width:"160px"}},{default:o(()=>[(c(!0),N(Z,null,h(A.value,r=>(c(),P(G,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),t(B,{class:"table-card"},{default:o(()=>[ee((c(),P(K,{data:E.value},{default:o(()=>[t(p,{prop:"priceDate",label:"日期",width:"140"}),t(p,{prop:"itemName",label:"硬件"}),t(p,{prop:"category",label:"分类",width:"140"}),t(p,{prop:"price",label:"价格",width:"140"},{default:o(({row:r})=>[m("￥"+ae(R(r.price)),1)]),_:1}),t(p,{prop:"remark",label:"备注"}),t(p,{prop:"createdBy",label:"录入人",width:"140"}),x.value?(c(),P(p,{key:0,label:"操作",width:"160"},{default:o(({row:r})=>[t(u,{link:"",type:"primary",onClick:Q=>Y(r)},{default:o(()=>[...e[14]||(e[14]=[m("编辑",-1)])]),_:1},8,["onClick"]),t(u,{link:"",type:"danger",onClick:Q=>q(r)},{default:o(()=>[...e[15]||(e[15]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})):F("",!0)]),_:1},8,["data"])),[[J,b.value]])]),_:1}),t(T,{modelValue:l.visible,"onUpdate:modelValue":e[9]||(e[9]=r=>l.visible=r),title:"硬件价格",width:"520px"},{footer:o(()=>[t(u,{onClick:e[8]||(e[8]=r=>l.visible=!1)},{default:o(()=>[...e[16]||(e[16]=[m("取消",-1)])]),_:1}),t(u,{type:"primary",loading:l.loading,onClick:j},{default:o(()=>[...e[17]||(e[17]=[m("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[t($,{ref_key:"formRef",ref:w,model:l.form,rules:S,"label-width":"90px"},{default:o(()=>[t(d,{label:"日期",prop:"priceDate"},{default:o(()=>[t(M,{modelValue:l.form.priceDate,"onUpdate:modelValue":e[3]||(e[3]=r=>l.form.priceDate=r),type:"date","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(d,{label:"硬件名称",prop:"itemName"},{default:o(()=>[t(k,{modelValue:l.form.itemName,"onUpdate:modelValue":e[4]||(e[4]=r=>l.form.itemName=r),placeholder:"如 CPU i9-14900K"},null,8,["modelValue"])]),_:1}),t(d,{label:"分类"},{default:o(()=>[t(k,{modelValue:l.form.category,"onUpdate:modelValue":e[5]||(e[5]=r=>l.form.category=r),placeholder:"如 CPU / 主板 / GPU"},null,8,["modelValue"])]),_:1}),t(d,{label:"价格",prop:"price"},{default:o(()=>[t(L,{modelValue:l.form.price,"onUpdate:modelValue":e[6]||(e[6]=r=>l.form.price=r),min:0,step:50,"controls-position":"right"},null,8,["modelValue"])]),_:1}),t(d,{label:"备注"},{default:o(()=>[t(k,{modelValue:l.form.remark,"onUpdate:modelValue":e[7]||(e[7]=r=>l.form.remark=r),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),fe=re(pe,[["__scopeId","data-v-825256f1"]]);export{fe as default};
