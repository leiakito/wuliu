import{f as We,c as fe,d as ce,u as Xe,a as et,b as tt,e as lt,m as at,g as ot,h as nt,i as st}from"./settlements-DeGhIWQ5.js";import{l as rt}from"./users-eHn9V8bz.js";import{l as it}from"./submissions-C1J54hJM.js";import{d as dt,u as ut,k as W,a as _,r as S,n as ge,M as mt,c as D,h as C,b as o,w as n,e as v,L as be,o as V,i as m,J as P,P as X,p as N,Q as pt,R as ft,x as U,I as $,q as z,E as f,T as B,_ as ct}from"./index-DSeUM942.js";const gt={class:"page"},bt={class:"page-header"},vt={class:"actions"},yt={style:{"margin-top":"8px","font-size":"12px",color:"#909399"}},kt={key:0,style:{color:"#f56c6c"}},St={style:{"margin-top":"8px","max-height":"100px","overflow-y":"auto"}},ve="draft-settlements-page-size",wt=dt({__name:"DraftSettlementsView",setup(Ct){const ye=ut(),ke=W(()=>{var t;return((t=ye.user)==null?void 0:t.role)==="ADMIN"}),ee=Number(localStorage.getItem(ve))||50,s=_({status:"DRAFT",ownerUsername:"",submitterUsername:"",trackingNumber:"",model:"",orderSn:"",dateRange:[],page:1,size:Number.isNaN(ee)?50:ee,sortProp:"orderTime",sortOrder:"ascending"}),h=S([]),L=S(0),R=S(!1),F=S(!1),j=S(),Y=S(null),q={prop:"orderTime",order:"ascending"},O=_({prop:q.prop,order:q.order}),g=S([]),te=S([]),Se=S([]),G=S([]),le=S([]),Z=S(!1),ae=async()=>{Z.value=!0;try{const t=await it({t:Date.now()});le.value=t.sort((e,a)=>e.localeCompare(a))}catch(t){console.error("加载归属用户列表失败",t)}finally{Z.value=!1}},oe=S([]),J=S(!1),ne=async()=>{J.value=!0;try{const t=await rt();oe.value=t.filter(e=>e==null?void 0:e.username).sort((e,a)=>(e.username||"").localeCompare(a.username||""))}finally{J.value=!1}},c=_({visible:!1,loading:!1,targetId:0,form:{amount:0,remark:"",version:0}}),d=_({visible:!1,loading:!1,form:{model:"",amount:null,status:"",scope:"MODEL"}}),y=_({visible:!1,loading:!1,form:{amount:null,remark:""}}),u=_({visible:!1,loading:!1,form:{snInput:"",amount:null},parsedSns:[],duplicateSns:[]}),K=W(()=>{var e,a,i,p,r;const t={page:s.page,size:s.size,status:s.status||void 0,ownerUsername:((e=s.ownerUsername)==null?void 0:e.trim())||void 0,submitterUsername:((a=s.submitterUsername)==null?void 0:a.trim())||void 0,trackingNumber:((i=s.trackingNumber)==null?void 0:i.trim())||void 0,model:((p=s.model)==null?void 0:p.trim())||void 0,orderSn:((r=s.orderSn)==null?void 0:r.trim())||void 0,sortProp:s.sortProp||void 0,sortOrder:s.sortOrder||void 0};return Array.isArray(s.dateRange)&&s.dateRange.length===2&&(t.startDate=s.dateRange[0],t.endDate=s.dateRange[1]),t}),Q=W(()=>h.value),se=t=>t?t.replace(/\s+/g,""):"",b=async()=>{var t;R.value=!0;try{s.trackingNumber=se(s.trackingNumber),s.orderSn=se(s.orderSn),console.log("查询参数:",K.value);const e=await We(K.value);console.log("后端返回数据:",e),console.log("记录数量:",(t=e==null?void 0:e.records)==null?void 0:t.length,"总数:",e==null?void 0:e.total),h.value=e.records||[],L.value=e.total||0,console.log("更新后的 records.value:",h.value.length),we(),xe()}finally{R.value=!1}},we=()=>{const t=new Set,e=new Set;h.value.forEach(a=>{a.model&&e.add(a.model),a.ownerUsername&&t.add(a.ownerUsername)}),Se.value=Array.from(t).sort((a,i)=>a.localeCompare(i)),G.value=Array.from(e).sort((a,i)=>a.localeCompare(i))},re=()=>{h.value=[],L.value=0,s.status="DRAFT",s.ownerUsername="",s.submitterUsername="",s.trackingNumber="",s.model="",s.orderSn="",s.dateRange=[],s.page=1,b()},H=()=>{re()},Ce=t=>{s.size=t,localStorage.setItem(ve,String(t)),s.page=1,b()},Ve=t=>{s.page=t,b()},Ue=t=>{te.value=t,g.value=t.map(e=>e.id)},xe=()=>{if(Q.value.length>0){const t=Q.value[0];Y.value=t,be(()=>{var e;(e=j.value)==null||e.setCurrentRow(t)})}else Y.value=null},_e=()=>"",De=t=>{O.prop=t.prop??"",O.order=t.order??null,s.sortProp=O.prop,s.sortOrder=O.order,s.page=1,b()},Ne=t=>{var a;const e=g.value.includes(t.id);(a=j.value)==null||a.toggleRowSelection(t,!e)},he=async(t,e,a)=>{var i,p;if(e!=null&&e!==a)try{const r={amount:e,remark:t.remark,version:t.version};await fe(t.id,r),t.status="CONFIRMED",t.amount=e,f.success(`记录 ${t.trackingNumber||t.orderSn} 已确认`),s.status==="DRAFT"&&(s.status="",await be(),b())}catch(r){console.error("快速确认失败:",r),t.amount=a;const k=((p=(i=r==null?void 0:r.response)==null?void 0:i.data)==null?void 0:p.message)||(r==null?void 0:r.message)||"";(k.includes("已被")||k.includes("修改"))&&f({type:"warning",message:"⚠️ 该记录已被其他用户修改，已自动刷新最新数据，请重新操作",duration:5e3,showClose:!0}),await b()}},Re=()=>{d.form.scope=g.value.length?"SELECTION":"MODEL",d.form.model=G.value[0]??"",d.form.amount=null,d.form.status=s.status||"",d.visible=!0},Fe=()=>{if(!g.value.length){f.info("请先选择结算记录");return}y.form.amount=null,y.form.remark="",y.visible=!0},Ee=t=>{c.visible=!0,c.targetId=t.id,c.form.amount=t.amount??0,c.form.remark=t.remark??"",c.form.version=t.version??0},Ie=async()=>{var t,e;if(c.targetId){c.loading=!0;try{const a={amount:c.form.amount,remark:c.form.remark,version:c.form.version};await fe(c.targetId,a),f.success("已确认"),c.visible=!1,s.status==="DRAFT"&&(s.status=""),b()}catch(a){const i=((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"";(i.includes("已被")||i.includes("修改"))&&f({type:"warning",message:"⚠️ 该记录已被其他用户修改，已自动刷新最新数据，请重新操作",duration:5e3,showClose:!0}),await b()}finally{c.loading=!1}}},Be=async()=>{if(!g.value.length){f.info("请选择记录");return}await B.confirm(`确认将选中的 ${g.value.length} 条记录移动到结账管理吗？`,"提示",{type:"info",confirmButtonText:"确认移动",cancelButtonText:"取消"});const t=await at(g.value);f.success(`已将 ${t} 条记录移动到结账管理`),g.value=[],b()},Oe=async()=>{if(!g.value.length){f.info("请选择记录");return}await B.confirm("确认删除选中的结算记录吗？","提示",{type:"warning"}),await ce(g.value),f.success("已删除"),g.value=[],b()},Te=async t=>{try{await B.confirm("确认删除该结算记录吗？","二次确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"})}catch{return}try{await ce([t.id]),f.success("已删除"),b()}catch(e){console.error("删除失败:",e),f.error("删除失败")}},Ae=async()=>{var t,e;if(d.form.amount===null||d.form.amount===void 0){f.warning("请输入金额");return}if(d.form.scope==="MODEL"){if(!d.form.model||!d.form.model.trim()){f.warning("请选择型号");return}d.loading=!0;try{const a={model:d.form.model.trim(),amount:d.form.amount,status:((t=d.form.status)==null?void 0:t.trim())||void 0,ownerUsername:((e=s.ownerUsername)==null?void 0:e.trim())||void 0};Array.isArray(s.dateRange)&&s.dateRange.length===2&&(a.startDate=s.dateRange[0],a.endDate=s.dateRange[1]),await Xe(a),f.success("批量价格已更新"),d.visible=!1,b()}finally{d.loading=!1}}else{if(!g.value.length){f.warning("请选择结算记录");return}d.loading=!0;try{const a={amount:d.form.amount,remark:void 0};await Promise.all(g.value.map(i=>et(i,a))),f.success("已更新所选记录金额"),d.visible=!1,b()}finally{d.loading=!1}}},Me=async()=>{if(!g.value.length){f.info("请先选择结算记录");return}y.loading=!0;try{const t={ids:[...g.value],amount:y.form.amount??void 0,remark:y.form.remark||void 0};await tt(t),f.success("批量确认成功"),y.visible=!1,g.value=[],te.value=[],s.status==="DRAFT"&&(s.status=""),b()}finally{y.loading=!1}},Pe=()=>{u.form.snInput="",u.form.amount=null,u.parsedSns=[],u.duplicateSns=[],u.visible=!0},ie=t=>t.split(/[\n,;]/).map(e=>e.trim()).filter(e=>e.length>0),de=t=>{const e=new Set,a=new Set;return t.forEach(i=>{const p=i.toUpperCase();e.has(p)?a.add(i):e.add(p)}),Array.from(a)},$e=async()=>{const t=ie(u.form.snInput),e=de(t);if(u.parsedSns=t,u.duplicateSns=e,t.length===0){f.warning("请输入至少一个SN");return}if(u.form.amount===null||u.form.amount===void 0){f.warning("请输入金额");return}const a=t.filter(i=>!e.includes(i));if(a.length===0){f.warning("所有SN都重复，无法设置价格");return}u.loading=!0;try{const i={sns:a,amount:u.form.amount},p=await lt(i),r=(p==null?void 0:p.updatedCount)??0,k=(p==null?void 0:p.skippedSns)??[];let x=`已更新 ${r} 个SN的价格`;e.length>0&&(x+=`，跳过 ${e.length} 个重复输入的SN`),k&&k.length>0?(x+=`，跳过 ${k.length} 个已有价格的SN`,f.warning({message:`${x}
已有价格的SN: ${k.join("、")}`,duration:5e3,showClose:!0})):f.success(x),u.visible=!1,b()}finally{u.loading=!1}};ge(()=>u.form.snInput,t=>{const e=ie(t),a=de(e);u.parsedSns=e,u.duplicateSns=a});const ue=async(t,e="settlements.xlsx")=>{const a=await st(t),i=new Blob([a.data],{type:"application/octet-stream"}),p=window.URL.createObjectURL(i),r=document.createElement("a");r.href=p,r.download=e,r.click(),window.URL.revokeObjectURL(p)},ze=async()=>{var t,e;F.value=!0;try{const a={status:s.status||void 0,ownerUsername:((t=s.ownerUsername)==null?void 0:t.trim())||void 0,submitterUsername:((e=s.submitterUsername)==null?void 0:e.trim())||void 0};Array.isArray(s.dateRange)&&s.dateRange.length===2&&(a.startDate=s.dateRange[0],a.endDate=s.dateRange[1]),await ue(a)}finally{F.value=!1}},Le=async()=>{try{await B.confirm("导出后会删除已确认的数据，确定继续吗？","二次确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"})}catch{return}F.value=!0;try{const t={status:"CONFIRMED"},e=new Date,a=e.getMonth()+1,i=e.getDate(),p=`${a}月${i}日.xlsx`;await ue(t,p);const r=await ot();console.log(`已从数据库删除 ${r} 条已确认的记录`),f.success(`已导出并删除 ${r} 条已确认记录`),b()}catch(t){console.error("导出或删除失败:",t),f.error("导出或删除操作失败")}finally{F.value=!1}},je=t=>t?t.replace("T"," ").replace("Z",""):"-",T=(t,e)=>{try{const a={tracking:{bg:t.trackingBgColor,fg:t.trackingFontColor,strike:t.trackingStrike},model:{bg:t.modelBgColor,fg:t.modelFontColor,strike:t.modelStrike},sn:{bg:t.snBgColor,fg:t.snFontColor,strike:t.snStrike},amount:{bg:t.amountBgColor,fg:t.amountFontColor,strike:t.amountStrike},remark:{bg:t.remarkBgColor,fg:t.remarkFontColor,strike:t.remarkStrike}}[e];if(!a)return{};const i={};return a.bg&&a.bg!=="#FFFFFF"&&a.bg!=="#FFF"&&String(a.bg).trim()!==""&&(i["background-color"]=a.bg),a.fg&&a.fg!=="#000000"&&a.fg!=="#000"&&String(a.fg).trim()!==""&&(i.color=a.fg),(a.strike===!0||a.strike==="true"||a.strike===1)&&(i["text-decoration"]="line-through"),i}catch(a){return console.warn("样式应用失败:",a),{}}};ge(ke,t=>{ne(),ae()},{immediate:!0}),mt(()=>{ne(),ae()});const Ye=async()=>{try{await B.confirm("这将根据当前筛选条件，确认所有待结账的记录（仅处理有金额的条目）。此操作不可撤销，确定继续吗？","确认全部操作",{confirmButtonText:"确定确认",cancelButtonText:"取消",type:"warning"})}catch{return}R.value=!0;try{const t={...K.value,status:"DRAFT"};delete t.page,delete t.size;const e=await nt(t);f.success(`操作成功，已确认 ${e} 条记录。`),s.status==="DRAFT"&&(s.status=""),b()}catch(t){console.error("确认全部失败:",t)}finally{R.value=!1}};return b(),(t,e)=>{const a=v("el-button"),i=v("el-option"),p=v("el-select"),r=v("el-form-item"),k=v("el-input"),x=v("el-date-picker"),E=v("el-form"),me=v("el-card"),w=v("el-table-column"),A=v("el-input-number"),qe=v("el-tag"),Ge=v("el-table"),Ze=v("el-pagination"),M=v("el-dialog"),pe=v("el-radio-button"),Je=v("el-radio-group"),Ke=v("el-alert"),Qe=ft("loading");return V(),D("div",gt,[C("div",bt,[e[34]||(e[34]=C("div",null,[C("h2",null,"待结账"),C("p",{class:"sub"},"个人工作台 - 整理、修改、确认待结账记录")],-1)),C("div",vt,[o(a,{type:"primary",plain:"",onClick:Re},{default:n(()=>[...e[26]||(e[26]=[m("批量设置价格",-1)])]),_:1}),o(a,{type:"success",plain:"",onClick:Le},{default:n(()=>[...e[27]||(e[27]=[m(" 导出已确认数据 ",-1)])]),_:1}),o(a,{type:"primary",plain:"",onClick:Pe},{default:n(()=>[...e[28]||(e[28]=[m("SN批量设置价格",-1)])]),_:1}),o(a,{type:"success",plain:"",disabled:!g.value.length,onClick:Fe},{default:n(()=>[...e[29]||(e[29]=[m("批量确认",-1)])]),_:1},8,["disabled"]),o(a,{type:"warning",plain:"",onClick:Ye},{default:n(()=>[...e[30]||(e[30]=[m("确认全部",-1)])]),_:1}),o(a,{onClick:ze,loading:F.value},{default:n(()=>[...e[31]||(e[31]=[m("导出 Excel",-1)])]),_:1},8,["loading"]),o(a,{type:"success",plain:"",disabled:!g.value.length,onClick:Be},{default:n(()=>[...e[32]||(e[32]=[m(" 移动到结账管理 ",-1)])]),_:1},8,["disabled"]),o(a,{type:"danger",plain:"",disabled:!g.value.length,onClick:Oe},{default:n(()=>[...e[33]||(e[33]=[m(" 删除所选 ",-1)])]),_:1},8,["disabled"])])]),o(me,null,{default:n(()=>[o(E,{inline:!0,model:s,class:"filter-form"},{default:n(()=>[o(r,{label:"状态"},{default:n(()=>[o(p,{modelValue:s.status,"onUpdate:modelValue":e[0]||(e[0]=l=>s.status=l),clearable:"",placeholder:"全部",style:{width:"160px"}},{default:n(()=>[o(i,{label:"草稿",value:"DRAFT"}),o(i,{label:"已确认",value:"CONFIRMED"})]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"单号"},{default:n(()=>[o(k,{modelValue:s.trackingNumber,"onUpdate:modelValue":e[1]||(e[1]=l=>s.trackingNumber=l),placeholder:"输入单号",clearable:"",style:{width:"200px"},onClear:H},null,8,["modelValue"])]),_:1}),o(r,{label:"型号"},{default:n(()=>[o(k,{modelValue:s.model,"onUpdate:modelValue":e[2]||(e[2]=l=>s.model=l),placeholder:"输入型号",clearable:"",style:{width:"200px"},onClear:H},null,8,["modelValue"])]),_:1}),o(r,{label:"SN"},{default:n(()=>[o(k,{modelValue:s.orderSn,"onUpdate:modelValue":e[3]||(e[3]=l=>s.orderSn=l),placeholder:"输入 SN",clearable:"",style:{width:"200px"},onClear:H},null,8,["modelValue"])]),_:1}),o(r,{label:"日期"},{default:n(()=>[o(x,{modelValue:s.dateRange,"onUpdate:modelValue":e[4]||(e[4]=l=>s.dateRange=l),type:"daterange","value-format":"YYYY-MM-DD","start-placeholder":"开始","end-placeholder":"结束"},null,8,["modelValue"])]),_:1}),o(r,{label:"归属用户"},{default:n(()=>[o(p,{modelValue:s.ownerUsername,"onUpdate:modelValue":e[5]||(e[5]=l=>s.ownerUsername=l),placeholder:"全部",clearable:"",filterable:"",style:{width:"200px"},loading:Z.value},{default:n(()=>[(V(!0),D(P,null,X(le.value,l=>(V(),N(i,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),o(r,{label:"提交人"},{default:n(()=>[o(p,{modelValue:s.submitterUsername,"onUpdate:modelValue":e[6]||(e[6]=l=>s.submitterUsername=l),placeholder:"全部",clearable:"",filterable:"",style:{width:"200px"},loading:J.value},{default:n(()=>[(V(!0),D(P,null,X(oe.value,l=>(V(),N(i,{key:l.username,label:l.fullName?`${l.fullName}（${l.username}）`:l.username,value:l.username},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),o(r,null,{default:n(()=>[o(a,{type:"primary",onClick:b},{default:n(()=>[...e[35]||(e[35]=[m("查询",-1)])]),_:1}),o(a,{onClick:re},{default:n(()=>[...e[36]||(e[36]=[m("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(me,{class:"table-card"},{default:n(()=>[pt((V(),N(Ge,{ref_key:"tableRef",ref:j,data:Q.value,height:"520","default-sort":q,"highlight-current-row":"","current-row":Y.value,"row-class-name":_e,onSelectionChange:Ue,onRowClick:Ne,onSortChange:De},{default:n(()=>[o(w,{type:"selection",width:"48"}),o(w,{prop:"orderTime",label:"下单时间",width:"180",sortable:"custom","sort-orders":["ascending","descending"]},{default:n(({row:l})=>[m(U(je(l.orderTime)),1)]),_:1}),o(w,{prop:"trackingNumber",label:"单号",width:"260",sortable:"custom","sort-orders":["ascending","descending"]},{default:n(({row:l})=>[C("span",{style:$(T(l,"tracking"))},U(l.trackingNumber),5)]),_:1}),o(w,{prop:"model",label:"型号",width:"400"},{default:n(({row:l})=>[C("span",{style:$(T(l,"model"))},U(l.model||"-"),5)]),_:1}),o(w,{prop:"orderSn",label:"SN",width:"340"},{default:n(({row:l})=>[C("span",{style:$(T(l,"sn"))},U(l.orderSn||"-"),5)]),_:1}),o(w,{prop:"amount",label:"结账金额",width:"180",sortable:"custom","sort-orders":["ascending","descending"]},{default:n(({row:l})=>[o(A,{modelValue:l.amount,"onUpdate:modelValue":I=>l.amount=I,min:0,step:10,size:"small",controls:!1,placeholder:"输入金额确认",style:{width:"100%"},onChange:(I,He)=>he(l,I,He)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o(w,{prop:"ownerUsername",label:"归属人",width:"100"},{default:n(({row:l})=>[m(U(l.ownerUsername||"-"),1)]),_:1}),o(w,{prop:"submitterUsername",label:"提交人",width:"100"},{default:n(({row:l})=>[m(U(l.submitterUsername||"-"),1)]),_:1}),o(w,{prop:"status",label:"状态",width:"100",sortable:"custom","sort-orders":["ascending","descending"]},{default:n(({row:l})=>[o(qe,{type:l.status==="CONFIRMED"?"success":"warning"},{default:n(()=>[m(U(l.status==="CONFIRMED"?"已确认":"待结账"),1)]),_:2},1032,["type"])]),_:1}),o(w,{prop:"payableAt",label:"应付日期",width:"140"}),o(w,{prop:"remark",label:"备注"},{default:n(({row:l})=>[C("span",{style:$(T(l,"remark"))},U(l.remark||"-"),5)]),_:1}),o(w,{label:"操作",width:"160"},{default:n(({row:l})=>[l.status!=="CONFIRMED"?(V(),N(a,{key:0,link:"",type:"primary",onClick:I=>Ee(l)},{default:n(()=>[...e[37]||(e[37]=[m(" 确认 ",-1)])]),_:1},8,["onClick"])):z("",!0),o(a,{link:"",type:"danger",onClick:I=>Te(l)},{default:n(()=>[...e[38]||(e[38]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","current-row"])),[[Qe,R.value]]),o(Ze,{"current-page":s.page,"onUpdate:currentPage":e[7]||(e[7]=l=>s.page=l),"page-size":s.size,"onUpdate:pageSize":e[8]||(e[8]=l=>s.size=l),total:L.value,layout:"total, sizes, prev, pager, next","page-sizes":[20,50,100,200],style:{"margin-top":"12px","justify-content":"flex-end"},onSizeChange:Ce,onCurrentChange:Ve},null,8,["current-page","page-size","total"])]),_:1}),o(M,{modelValue:c.visible,"onUpdate:modelValue":e[12]||(e[12]=l=>c.visible=l),title:"确认结账",width:"480px","destroy-on-close":!0},{footer:n(()=>[o(a,{onClick:e[11]||(e[11]=l=>c.visible=!1)},{default:n(()=>[...e[39]||(e[39]=[m("取消",-1)])]),_:1}),o(a,{type:"primary",loading:c.loading,onClick:Ie},{default:n(()=>[...e[40]||(e[40]=[m("确认",-1)])]),_:1},8,["loading"])]),default:n(()=>[o(E,{"label-width":"100px"},{default:n(()=>[o(r,{label:"金额"},{default:n(()=>[o(A,{modelValue:c.form.amount,"onUpdate:modelValue":e[9]||(e[9]=l=>c.form.amount=l),min:0,step:10,controls:!1,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),o(r,{label:"备注"},{default:n(()=>[o(k,{modelValue:c.form.remark,"onUpdate:modelValue":e[10]||(e[10]=l=>c.form.remark=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(M,{modelValue:d.visible,"onUpdate:modelValue":e[18]||(e[18]=l=>d.visible=l),title:"批量设置价格",width:"420px","destroy-on-close":!0},{footer:n(()=>[o(a,{onClick:e[17]||(e[17]=l=>d.visible=!1)},{default:n(()=>[...e[43]||(e[43]=[m("取消",-1)])]),_:1}),o(a,{type:"primary",loading:d.loading,onClick:Ae},{default:n(()=>[...e[44]||(e[44]=[m("保存",-1)])]),_:1},8,["loading"])]),default:n(()=>[o(E,{"label-width":"100px"},{default:n(()=>[o(r,{label:"作用范围"},{default:n(()=>[o(Je,{modelValue:d.form.scope,"onUpdate:modelValue":e[13]||(e[13]=l=>d.form.scope=l)},{default:n(()=>[o(pe,{label:"MODEL"},{default:n(()=>[...e[41]||(e[41]=[m("按型号筛选",-1)])]),_:1}),o(pe,{label:"SELECTION",disabled:!g.value.length},{default:n(()=>[...e[42]||(e[42]=[m("已选择记录",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),d.form.scope==="MODEL"?(V(),D(P,{key:0},[o(r,{label:"型号"},{default:n(()=>[o(p,{modelValue:d.form.model,"onUpdate:modelValue":e[14]||(e[14]=l=>d.form.model=l),placeholder:"请选择型号",filterable:"","allow-create":""},{default:n(()=>[(V(!0),D(P,null,X(G.value,l=>(V(),N(i,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(r,{label:"状态范围"},{default:n(()=>[o(p,{modelValue:d.form.status,"onUpdate:modelValue":e[15]||(e[15]=l=>d.form.status=l),placeholder:"全部",clearable:"",style:{width:"200px"}},{default:n(()=>[o(i,{label:"待结账",value:"PENDING"}),o(i,{label:"已确认",value:"CONFIRMED"})]),_:1},8,["modelValue"])]),_:1})],64)):z("",!0),o(r,{label:"金额"},{default:n(()=>[o(A,{modelValue:d.form.amount,"onUpdate:modelValue":e[16]||(e[16]=l=>d.form.amount=l),min:0,step:10,controls:!1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(M,{modelValue:y.visible,"onUpdate:modelValue":e[21]||(e[21]=l=>y.visible=l),title:"批量确认",width:"420px","destroy-on-close":!0},{footer:n(()=>[o(a,{onClick:e[20]||(e[20]=l=>y.visible=!1)},{default:n(()=>[...e[45]||(e[45]=[m("取消",-1)])]),_:1}),o(a,{type:"primary",loading:y.loading,onClick:Me},{default:n(()=>[...e[46]||(e[46]=[m("确认",-1)])]),_:1},8,["loading"])]),default:n(()=>[o(E,{"label-width":"100px"},{default:n(()=>[o(r,{label:"备注"},{default:n(()=>[o(k,{modelValue:y.form.remark,"onUpdate:modelValue":e[19]||(e[19]=l=>y.form.remark=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(M,{modelValue:u.visible,"onUpdate:modelValue":e[25]||(e[25]=l=>u.visible=l),title:"SN批量设置价格",width:"520px","destroy-on-close":!0},{footer:n(()=>[o(a,{onClick:e[24]||(e[24]=l=>u.visible=!1)},{default:n(()=>[...e[48]||(e[48]=[m("取消",-1)])]),_:1}),o(a,{type:"primary",loading:u.loading,onClick:$e,disabled:u.parsedSns.length===0},{default:n(()=>[...e[49]||(e[49]=[m("保存",-1)])]),_:1},8,["loading","disabled"])]),default:n(()=>[o(E,{"label-width":"100px"},{default:n(()=>[o(r,{label:"SN列表"},{default:n(()=>[o(k,{modelValue:u.form.snInput,"onUpdate:modelValue":e[22]||(e[22]=l=>u.form.snInput=l),type:"textarea",rows:6,placeholder:"支持多个SN，使用换行/逗号/分号分隔"},null,8,["modelValue"]),C("div",yt,[m(" 已识别 "+U(u.parsedSns.length)+" 个SN ",1),u.duplicateSns.length>0?(V(),D("span",kt," (发现 "+U(u.duplicateSns.length)+" 个重复) ",1)):z("",!0)])]),_:1}),o(r,{label:"金额"},{default:n(()=>[o(A,{modelValue:u.form.amount,"onUpdate:modelValue":e[23]||(e[23]=l=>u.form.amount=l),min:0,step:10,controls:!1},null,8,["modelValue"])]),_:1}),u.duplicateSns.length>0?(V(),N(Ke,{key:0,type:"warning",closable:!1,style:{"margin-bottom":"12px"}},{title:n(()=>[e[47]||(e[47]=C("div",null,"检测到重复SN，将跳过以下SN：",-1)),C("div",St,U(u.duplicateSns.join("、")),1)]),_:1})):z("",!0)]),_:1})]),_:1},8,["modelValue"])])}}}),Dt=ct(wt,[["__scopeId","data-v-a1a3e149"]]);export{Dt as default};
