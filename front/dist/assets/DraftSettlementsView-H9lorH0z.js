import{f as We,c as fe,d as ce,u as Xe,a as et,b as tt,e as lt,m as at,g as ot,h as nt,i as rt}from"./settlements-bV1gEBZA.js";import{l as st}from"./users-iWmjUf7j.js";import{l as it}from"./submissions-DVKte-tD.js";import{d as dt,u as ut,k as W,a as _,r as k,n as ge,M as mt,c as D,h as w,b as a,w as n,e as v,L as be,o as C,i as m,J as P,P as X,p as N,Q as pt,R as ft,x as U,I as $,q as z,E as p,T as B,_ as ct}from"./index-DVwYDEL5.js";const gt={class:"page"},bt={class:"page-header"},vt={class:"actions"},yt={style:{"margin-top":"8px","font-size":"12px",color:"#909399"}},kt={key:0,style:{color:"#f56c6c"}},St={style:{"margin-top":"8px","max-height":"100px","overflow-y":"auto"}},ve="draft-settlements-page-size",wt=dt({__name:"DraftSettlementsView",setup(Ct){const ye=ut(),ke=W(()=>{var t;return((t=ye.user)==null?void 0:t.role)==="ADMIN"}),ee=Number(localStorage.getItem(ve))||50,r=_({status:"DRAFT",ownerUsername:"",submitterUsername:"",trackingNumber:"",model:"",orderSn:"",dateRange:[],page:1,size:Number.isNaN(ee)?50:ee,sortProp:"orderTime",sortOrder:"ascending"}),R=k([]),L=k(0),h=k(!1),F=k(!1),j=k(),Y=k(null),q={prop:"orderTime",order:"ascending"},O=_({prop:q.prop,order:q.order}),c=k([]),te=k([]),Se=k([]),G=k([]),le=k([]),Z=k(!1),ae=async()=>{Z.value=!0;try{const t=await it({t:Date.now()});le.value=t.sort((e,o)=>e.localeCompare(o))}catch(t){console.error("加载归属用户列表失败",t)}finally{Z.value=!1}},oe=k([]),J=k(!1),ne=async()=>{J.value=!0;try{const t=await st();oe.value=t.filter(e=>e==null?void 0:e.username).sort((e,o)=>(e.username||"").localeCompare(o.username||""))}finally{J.value=!1}},g=_({visible:!1,loading:!1,targetId:0,form:{amount:0,remark:""}}),i=_({visible:!1,loading:!1,form:{model:"",amount:null,status:"",scope:"MODEL"}}),y=_({visible:!1,loading:!1,form:{amount:null,remark:""}}),d=_({visible:!1,loading:!1,form:{snInput:"",amount:null},parsedSns:[],duplicateSns:[]}),K=W(()=>{var e,o,s,f,u;const t={page:r.page,size:r.size,status:r.status||void 0,ownerUsername:((e=r.ownerUsername)==null?void 0:e.trim())||void 0,submitterUsername:((o=r.submitterUsername)==null?void 0:o.trim())||void 0,trackingNumber:((s=r.trackingNumber)==null?void 0:s.trim())||void 0,model:((f=r.model)==null?void 0:f.trim())||void 0,orderSn:((u=r.orderSn)==null?void 0:u.trim())||void 0,sortProp:r.sortProp||void 0,sortOrder:r.sortOrder||void 0};return Array.isArray(r.dateRange)&&r.dateRange.length===2&&(t.startDate=r.dateRange[0],t.endDate=r.dateRange[1]),t}),Q=W(()=>R.value),re=t=>t?t.replace(/\s+/g,""):"",b=async()=>{var t;h.value=!0;try{r.trackingNumber=re(r.trackingNumber),r.orderSn=re(r.orderSn),console.log("查询参数:",K.value);const e=await We(K.value);console.log("后端返回数据:",e),console.log("记录数量:",(t=e==null?void 0:e.records)==null?void 0:t.length,"总数:",e==null?void 0:e.total),R.value=e.records||[],L.value=e.total||0,console.log("更新后的 records.value:",R.value.length),we(),xe()}finally{h.value=!1}},we=()=>{const t=new Set,e=new Set;R.value.forEach(o=>{o.model&&e.add(o.model),o.ownerUsername&&t.add(o.ownerUsername)}),Se.value=Array.from(t).sort((o,s)=>o.localeCompare(s)),G.value=Array.from(e).sort((o,s)=>o.localeCompare(s))},se=()=>{R.value=[],L.value=0,r.status="DRAFT",r.ownerUsername="",r.submitterUsername="",r.trackingNumber="",r.model="",r.orderSn="",r.dateRange=[],r.page=1,b()},H=()=>{se()},Ce=t=>{r.size=t,localStorage.setItem(ve,String(t)),r.page=1,b()},Ve=t=>{r.page=t,b()},Ue=t=>{te.value=t,c.value=t.map(e=>e.id)},xe=()=>{if(Q.value.length>0){const t=Q.value[0];Y.value=t,be(()=>{var e;(e=j.value)==null||e.setCurrentRow(t)})}else Y.value=null},_e=()=>"",De=t=>{O.prop=t.prop??"",O.order=t.order??null,r.sortProp=O.prop,r.sortOrder=O.order,r.page=1,b()},Ne=t=>{var o;const e=c.value.includes(t.id);(o=j.value)==null||o.toggleRowSelection(t,!e)},Re=async(t,e,o)=>{if(e!=null&&e!==o)try{const s={amount:e,remark:t.remark};await fe(t.id,s),t.status="CONFIRMED",t.amount=e,p.success(`记录 ${t.trackingNumber||t.orderSn} 已确认`),r.status==="DRAFT"&&(r.status="",await be(),b())}catch(s){console.error("快速确认失败:",s),t.amount=o,p.error("确认失败，请重试")}},he=()=>{i.form.scope=c.value.length?"SELECTION":"MODEL",i.form.model=G.value[0]??"",i.form.amount=null,i.form.status=r.status||"",i.visible=!0},Fe=()=>{if(!c.value.length){p.info("请先选择结算记录");return}y.form.amount=null,y.form.remark="",y.visible=!0},Ee=t=>{g.visible=!0,g.targetId=t.id,g.form.amount=t.amount??0,g.form.remark=t.remark??""},Ie=async()=>{if(g.targetId){g.loading=!0;try{const t={amount:g.form.amount,remark:g.form.remark};await fe(g.targetId,t),p.success("已确认"),g.visible=!1,r.status==="DRAFT"&&(r.status=""),b()}finally{g.loading=!1}}},Be=async()=>{if(!c.value.length){p.info("请选择记录");return}await B.confirm(`确认将选中的 ${c.value.length} 条记录移动到结账管理吗？`,"提示",{type:"info",confirmButtonText:"确认移动",cancelButtonText:"取消"});const t=await at(c.value);p.success(`已将 ${t} 条记录移动到结账管理`),c.value=[],b()},Oe=async()=>{if(!c.value.length){p.info("请选择记录");return}await B.confirm("确认删除选中的结算记录吗？","提示",{type:"warning"}),await ce(c.value),p.success("已删除"),c.value=[],b()},Te=async t=>{try{await B.confirm("确认删除该结算记录吗？","二次确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"})}catch{return}try{await ce([t.id]),p.success("已删除"),b()}catch(e){console.error("删除失败:",e),p.error("删除失败")}},Ae=async()=>{var t,e;if(i.form.amount===null||i.form.amount===void 0){p.warning("请输入金额");return}if(i.form.scope==="MODEL"){if(!i.form.model||!i.form.model.trim()){p.warning("请选择型号");return}i.loading=!0;try{const o={model:i.form.model.trim(),amount:i.form.amount,status:((t=i.form.status)==null?void 0:t.trim())||void 0,ownerUsername:((e=r.ownerUsername)==null?void 0:e.trim())||void 0};Array.isArray(r.dateRange)&&r.dateRange.length===2&&(o.startDate=r.dateRange[0],o.endDate=r.dateRange[1]),await Xe(o),p.success("批量价格已更新"),i.visible=!1,b()}finally{i.loading=!1}}else{if(!c.value.length){p.warning("请选择结算记录");return}i.loading=!0;try{const o={amount:i.form.amount,remark:void 0};await Promise.all(c.value.map(s=>et(s,o))),p.success("已更新所选记录金额"),i.visible=!1,b()}finally{i.loading=!1}}},Me=async()=>{if(!c.value.length){p.info("请先选择结算记录");return}y.loading=!0;try{const t={ids:[...c.value],amount:y.form.amount??void 0,remark:y.form.remark||void 0};await tt(t),p.success("批量确认成功"),y.visible=!1,c.value=[],te.value=[],r.status==="DRAFT"&&(r.status=""),b()}finally{y.loading=!1}},Pe=()=>{d.form.snInput="",d.form.amount=null,d.parsedSns=[],d.duplicateSns=[],d.visible=!0},ie=t=>t.split(/[\n,;]/).map(e=>e.trim()).filter(e=>e.length>0),de=t=>{const e=new Set,o=new Set;return t.forEach(s=>{const f=s.toUpperCase();e.has(f)?o.add(s):e.add(f)}),Array.from(o)},$e=async()=>{const t=ie(d.form.snInput),e=de(t);if(d.parsedSns=t,d.duplicateSns=e,t.length===0){p.warning("请输入至少一个SN");return}if(d.form.amount===null||d.form.amount===void 0){p.warning("请输入金额");return}const o=t.filter(s=>!e.includes(s));if(o.length===0){p.warning("所有SN都重复，无法设置价格");return}d.loading=!0;try{const s={sns:o,amount:d.form.amount},f=await lt(s),u=(f==null?void 0:f.updatedCount)??0,V=(f==null?void 0:f.skippedSns)??[];let x=`已更新 ${u} 个SN的价格`;e.length>0&&(x+=`，跳过 ${e.length} 个重复输入的SN`),V&&V.length>0?(x+=`，跳过 ${V.length} 个已有价格的SN`,p.warning({message:`${x}
已有价格的SN: ${V.join("、")}`,duration:5e3,showClose:!0})):p.success(x),d.visible=!1,b()}finally{d.loading=!1}};ge(()=>d.form.snInput,t=>{const e=ie(t),o=de(e);d.parsedSns=e,d.duplicateSns=o});const ue=async(t,e="settlements.xlsx")=>{const o=await rt(t),s=new Blob([o.data],{type:"application/octet-stream"}),f=window.URL.createObjectURL(s),u=document.createElement("a");u.href=f,u.download=e,u.click(),window.URL.revokeObjectURL(f)},ze=async()=>{var t,e;F.value=!0;try{const o={status:r.status||void 0,ownerUsername:((t=r.ownerUsername)==null?void 0:t.trim())||void 0,submitterUsername:((e=r.submitterUsername)==null?void 0:e.trim())||void 0};Array.isArray(r.dateRange)&&r.dateRange.length===2&&(o.startDate=r.dateRange[0],o.endDate=r.dateRange[1]),await ue(o)}finally{F.value=!1}},Le=async()=>{try{await B.confirm("导出后会删除已确认的数据，确定继续吗？","二次确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"})}catch{return}F.value=!0;try{const t={status:"CONFIRMED"},e=new Date,o=e.getMonth()+1,s=e.getDate(),f=`${o}月${s}日.xlsx`;await ue(t,f);const u=await ot();console.log(`已从数据库删除 ${u} 条已确认的记录`),p.success(`已导出并删除 ${u} 条已确认记录`),b()}catch(t){console.error("导出或删除失败:",t),p.error("导出或删除操作失败")}finally{F.value=!1}},je=t=>t?t.replace("T"," ").replace("Z",""):"-",T=(t,e)=>{try{const o={tracking:{bg:t.trackingBgColor,fg:t.trackingFontColor,strike:t.trackingStrike},model:{bg:t.modelBgColor,fg:t.modelFontColor,strike:t.modelStrike},sn:{bg:t.snBgColor,fg:t.snFontColor,strike:t.snStrike},amount:{bg:t.amountBgColor,fg:t.amountFontColor,strike:t.amountStrike},remark:{bg:t.remarkBgColor,fg:t.remarkFontColor,strike:t.remarkStrike}}[e];if(!o)return{};const s={};return o.bg&&o.bg!=="#FFFFFF"&&o.bg!=="#FFF"&&String(o.bg).trim()!==""&&(s["background-color"]=o.bg),o.fg&&o.fg!=="#000000"&&o.fg!=="#000"&&String(o.fg).trim()!==""&&(s.color=o.fg),(o.strike===!0||o.strike==="true"||o.strike===1)&&(s["text-decoration"]="line-through"),s}catch(o){return console.warn("样式应用失败:",o),{}}};ge(ke,t=>{ne(),ae()},{immediate:!0}),mt(()=>{ne(),ae()});const Ye=async()=>{try{await B.confirm("这将根据当前筛选条件，确认所有待结账的记录（仅处理有金额的条目）。此操作不可撤销，确定继续吗？","确认全部操作",{confirmButtonText:"确定确认",cancelButtonText:"取消",type:"warning"})}catch{return}h.value=!0;try{const t={...K.value,status:"DRAFT"};delete t.page,delete t.size;const e=await nt(t);p.success(`操作成功，已确认 ${e} 条记录。`),r.status==="DRAFT"&&(r.status=""),b()}catch(t){console.error("确认全部失败:",t)}finally{h.value=!1}};return b(),(t,e)=>{const o=v("el-button"),s=v("el-option"),f=v("el-select"),u=v("el-form-item"),V=v("el-input"),x=v("el-date-picker"),E=v("el-form"),me=v("el-card"),S=v("el-table-column"),A=v("el-input-number"),qe=v("el-tag"),Ge=v("el-table"),Ze=v("el-pagination"),M=v("el-dialog"),pe=v("el-radio-button"),Je=v("el-radio-group"),Ke=v("el-alert"),Qe=ft("loading");return C(),D("div",gt,[w("div",bt,[e[34]||(e[34]=w("div",null,[w("h2",null,"待结账"),w("p",{class:"sub"},"个人工作台 - 整理、修改、确认待结账记录")],-1)),w("div",vt,[a(o,{type:"primary",plain:"",onClick:he},{default:n(()=>[...e[26]||(e[26]=[m("批量设置价格",-1)])]),_:1}),a(o,{type:"success",plain:"",onClick:Le},{default:n(()=>[...e[27]||(e[27]=[m(" 导出已确认数据 ",-1)])]),_:1}),a(o,{type:"primary",plain:"",onClick:Pe},{default:n(()=>[...e[28]||(e[28]=[m("SN批量设置价格",-1)])]),_:1}),a(o,{type:"success",plain:"",disabled:!c.value.length,onClick:Fe},{default:n(()=>[...e[29]||(e[29]=[m("批量确认",-1)])]),_:1},8,["disabled"]),a(o,{type:"warning",plain:"",onClick:Ye},{default:n(()=>[...e[30]||(e[30]=[m("确认全部",-1)])]),_:1}),a(o,{onClick:ze,loading:F.value},{default:n(()=>[...e[31]||(e[31]=[m("导出 Excel",-1)])]),_:1},8,["loading"]),a(o,{type:"success",plain:"",disabled:!c.value.length,onClick:Be},{default:n(()=>[...e[32]||(e[32]=[m(" 移动到结账管理 ",-1)])]),_:1},8,["disabled"]),a(o,{type:"danger",plain:"",disabled:!c.value.length,onClick:Oe},{default:n(()=>[...e[33]||(e[33]=[m(" 删除所选 ",-1)])]),_:1},8,["disabled"])])]),a(me,null,{default:n(()=>[a(E,{inline:!0,model:r,class:"filter-form"},{default:n(()=>[a(u,{label:"状态"},{default:n(()=>[a(f,{modelValue:r.status,"onUpdate:modelValue":e[0]||(e[0]=l=>r.status=l),clearable:"",placeholder:"全部",style:{width:"160px"}},{default:n(()=>[a(s,{label:"草稿",value:"DRAFT"}),a(s,{label:"已确认",value:"CONFIRMED"})]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"单号"},{default:n(()=>[a(V,{modelValue:r.trackingNumber,"onUpdate:modelValue":e[1]||(e[1]=l=>r.trackingNumber=l),placeholder:"输入单号",clearable:"",style:{width:"200px"},onClear:H},null,8,["modelValue"])]),_:1}),a(u,{label:"型号"},{default:n(()=>[a(V,{modelValue:r.model,"onUpdate:modelValue":e[2]||(e[2]=l=>r.model=l),placeholder:"输入型号",clearable:"",style:{width:"200px"},onClear:H},null,8,["modelValue"])]),_:1}),a(u,{label:"SN"},{default:n(()=>[a(V,{modelValue:r.orderSn,"onUpdate:modelValue":e[3]||(e[3]=l=>r.orderSn=l),placeholder:"输入 SN",clearable:"",style:{width:"200px"},onClear:H},null,8,["modelValue"])]),_:1}),a(u,{label:"日期"},{default:n(()=>[a(x,{modelValue:r.dateRange,"onUpdate:modelValue":e[4]||(e[4]=l=>r.dateRange=l),type:"daterange","value-format":"YYYY-MM-DD","start-placeholder":"开始","end-placeholder":"结束"},null,8,["modelValue"])]),_:1}),a(u,{label:"归属用户"},{default:n(()=>[a(f,{modelValue:r.ownerUsername,"onUpdate:modelValue":e[5]||(e[5]=l=>r.ownerUsername=l),placeholder:"全部",clearable:"",filterable:"",style:{width:"200px"},loading:Z.value},{default:n(()=>[(C(!0),D(P,null,X(le.value,l=>(C(),N(s,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),a(u,{label:"提交人"},{default:n(()=>[a(f,{modelValue:r.submitterUsername,"onUpdate:modelValue":e[6]||(e[6]=l=>r.submitterUsername=l),placeholder:"全部",clearable:"",filterable:"",style:{width:"200px"},loading:J.value},{default:n(()=>[(C(!0),D(P,null,X(oe.value,l=>(C(),N(s,{key:l.username,label:l.fullName?`${l.fullName}（${l.username}）`:l.username,value:l.username},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),a(u,null,{default:n(()=>[a(o,{type:"primary",onClick:b},{default:n(()=>[...e[35]||(e[35]=[m("查询",-1)])]),_:1}),a(o,{onClick:se},{default:n(()=>[...e[36]||(e[36]=[m("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(me,{class:"table-card"},{default:n(()=>[pt((C(),N(Ge,{ref_key:"tableRef",ref:j,data:Q.value,height:"520","default-sort":q,"highlight-current-row":"","current-row":Y.value,"row-class-name":_e,onSelectionChange:Ue,onRowClick:Ne,onSortChange:De},{default:n(()=>[a(S,{type:"selection",width:"48"}),a(S,{prop:"orderTime",label:"下单时间",width:"180",sortable:"custom","sort-orders":["ascending","descending"]},{default:n(({row:l})=>[m(U(je(l.orderTime)),1)]),_:1}),a(S,{prop:"trackingNumber",label:"单号",width:"260",sortable:"custom","sort-orders":["ascending","descending"]},{default:n(({row:l})=>[w("span",{style:$(T(l,"tracking"))},U(l.trackingNumber),5)]),_:1}),a(S,{prop:"model",label:"型号",width:"400"},{default:n(({row:l})=>[w("span",{style:$(T(l,"model"))},U(l.model||"-"),5)]),_:1}),a(S,{prop:"orderSn",label:"SN",width:"340"},{default:n(({row:l})=>[w("span",{style:$(T(l,"sn"))},U(l.orderSn||"-"),5)]),_:1}),a(S,{prop:"amount",label:"结账金额",width:"180",sortable:"custom","sort-orders":["ascending","descending"]},{default:n(({row:l})=>[a(A,{modelValue:l.amount,"onUpdate:modelValue":I=>l.amount=I,min:0,step:10,size:"small",controls:!1,placeholder:"输入金额确认",style:{width:"100%"},onChange:(I,He)=>Re(l,I,He)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(S,{prop:"ownerUsername",label:"归属人",width:"100"},{default:n(({row:l})=>[m(U(l.ownerUsername||"-"),1)]),_:1}),a(S,{prop:"submitterUsername",label:"提交人",width:"100"},{default:n(({row:l})=>[m(U(l.submitterUsername||"-"),1)]),_:1}),a(S,{prop:"status",label:"状态",width:"100",sortable:"custom","sort-orders":["ascending","descending"]},{default:n(({row:l})=>[a(qe,{type:l.status==="CONFIRMED"?"success":"warning"},{default:n(()=>[m(U(l.status==="CONFIRMED"?"已确认":"待结账"),1)]),_:2},1032,["type"])]),_:1}),a(S,{prop:"payableAt",label:"应付日期",width:"140"}),a(S,{prop:"remark",label:"备注"},{default:n(({row:l})=>[w("span",{style:$(T(l,"remark"))},U(l.remark||"-"),5)]),_:1}),a(S,{label:"操作",width:"160"},{default:n(({row:l})=>[l.status!=="CONFIRMED"?(C(),N(o,{key:0,link:"",type:"primary",onClick:I=>Ee(l)},{default:n(()=>[...e[37]||(e[37]=[m(" 确认 ",-1)])]),_:1},8,["onClick"])):z("",!0),a(o,{link:"",type:"danger",onClick:I=>Te(l)},{default:n(()=>[...e[38]||(e[38]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","current-row"])),[[Qe,h.value]]),a(Ze,{"current-page":r.page,"onUpdate:currentPage":e[7]||(e[7]=l=>r.page=l),"page-size":r.size,"onUpdate:pageSize":e[8]||(e[8]=l=>r.size=l),total:L.value,layout:"total, sizes, prev, pager, next","page-sizes":[20,50,100,200],style:{"margin-top":"12px","justify-content":"flex-end"},onSizeChange:Ce,onCurrentChange:Ve},null,8,["current-page","page-size","total"])]),_:1}),a(M,{modelValue:g.visible,"onUpdate:modelValue":e[12]||(e[12]=l=>g.visible=l),title:"确认结账",width:"480px","destroy-on-close":!0},{footer:n(()=>[a(o,{onClick:e[11]||(e[11]=l=>g.visible=!1)},{default:n(()=>[...e[39]||(e[39]=[m("取消",-1)])]),_:1}),a(o,{type:"primary",loading:g.loading,onClick:Ie},{default:n(()=>[...e[40]||(e[40]=[m("确认",-1)])]),_:1},8,["loading"])]),default:n(()=>[a(E,{"label-width":"100px"},{default:n(()=>[a(u,{label:"金额"},{default:n(()=>[a(A,{modelValue:g.form.amount,"onUpdate:modelValue":e[9]||(e[9]=l=>g.form.amount=l),min:0,step:10,controls:!1,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),a(u,{label:"备注"},{default:n(()=>[a(V,{modelValue:g.form.remark,"onUpdate:modelValue":e[10]||(e[10]=l=>g.form.remark=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(M,{modelValue:i.visible,"onUpdate:modelValue":e[18]||(e[18]=l=>i.visible=l),title:"批量设置价格",width:"420px","destroy-on-close":!0},{footer:n(()=>[a(o,{onClick:e[17]||(e[17]=l=>i.visible=!1)},{default:n(()=>[...e[43]||(e[43]=[m("取消",-1)])]),_:1}),a(o,{type:"primary",loading:i.loading,onClick:Ae},{default:n(()=>[...e[44]||(e[44]=[m("保存",-1)])]),_:1},8,["loading"])]),default:n(()=>[a(E,{"label-width":"100px"},{default:n(()=>[a(u,{label:"作用范围"},{default:n(()=>[a(Je,{modelValue:i.form.scope,"onUpdate:modelValue":e[13]||(e[13]=l=>i.form.scope=l)},{default:n(()=>[a(pe,{label:"MODEL"},{default:n(()=>[...e[41]||(e[41]=[m("按型号筛选",-1)])]),_:1}),a(pe,{label:"SELECTION",disabled:!c.value.length},{default:n(()=>[...e[42]||(e[42]=[m("已选择记录",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),i.form.scope==="MODEL"?(C(),D(P,{key:0},[a(u,{label:"型号"},{default:n(()=>[a(f,{modelValue:i.form.model,"onUpdate:modelValue":e[14]||(e[14]=l=>i.form.model=l),placeholder:"请选择型号",filterable:"","allow-create":""},{default:n(()=>[(C(!0),D(P,null,X(G.value,l=>(C(),N(s,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"状态范围"},{default:n(()=>[a(f,{modelValue:i.form.status,"onUpdate:modelValue":e[15]||(e[15]=l=>i.form.status=l),placeholder:"全部",clearable:"",style:{width:"200px"}},{default:n(()=>[a(s,{label:"待结账",value:"PENDING"}),a(s,{label:"已确认",value:"CONFIRMED"})]),_:1},8,["modelValue"])]),_:1})],64)):z("",!0),a(u,{label:"金额"},{default:n(()=>[a(A,{modelValue:i.form.amount,"onUpdate:modelValue":e[16]||(e[16]=l=>i.form.amount=l),min:0,step:10,controls:!1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(M,{modelValue:y.visible,"onUpdate:modelValue":e[21]||(e[21]=l=>y.visible=l),title:"批量确认",width:"420px","destroy-on-close":!0},{footer:n(()=>[a(o,{onClick:e[20]||(e[20]=l=>y.visible=!1)},{default:n(()=>[...e[45]||(e[45]=[m("取消",-1)])]),_:1}),a(o,{type:"primary",loading:y.loading,onClick:Me},{default:n(()=>[...e[46]||(e[46]=[m("确认",-1)])]),_:1},8,["loading"])]),default:n(()=>[a(E,{"label-width":"100px"},{default:n(()=>[a(u,{label:"备注"},{default:n(()=>[a(V,{modelValue:y.form.remark,"onUpdate:modelValue":e[19]||(e[19]=l=>y.form.remark=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(M,{modelValue:d.visible,"onUpdate:modelValue":e[25]||(e[25]=l=>d.visible=l),title:"SN批量设置价格",width:"520px","destroy-on-close":!0},{footer:n(()=>[a(o,{onClick:e[24]||(e[24]=l=>d.visible=!1)},{default:n(()=>[...e[48]||(e[48]=[m("取消",-1)])]),_:1}),a(o,{type:"primary",loading:d.loading,onClick:$e,disabled:d.parsedSns.length===0},{default:n(()=>[...e[49]||(e[49]=[m("保存",-1)])]),_:1},8,["loading","disabled"])]),default:n(()=>[a(E,{"label-width":"100px"},{default:n(()=>[a(u,{label:"SN列表"},{default:n(()=>[a(V,{modelValue:d.form.snInput,"onUpdate:modelValue":e[22]||(e[22]=l=>d.form.snInput=l),type:"textarea",rows:6,placeholder:"支持多个SN，使用换行/逗号/分号分隔"},null,8,["modelValue"]),w("div",yt,[m(" 已识别 "+U(d.parsedSns.length)+" 个SN ",1),d.duplicateSns.length>0?(C(),D("span",kt," (发现 "+U(d.duplicateSns.length)+" 个重复) ",1)):z("",!0)])]),_:1}),a(u,{label:"金额"},{default:n(()=>[a(A,{modelValue:d.form.amount,"onUpdate:modelValue":e[23]||(e[23]=l=>d.form.amount=l),min:0,step:10,controls:!1},null,8,["modelValue"])]),_:1}),d.duplicateSns.length>0?(C(),N(Ke,{key:0,type:"warning",closable:!1,style:{"margin-bottom":"12px"}},{title:n(()=>[e[47]||(e[47]=w("div",null,"检测到重复SN，将跳过以下SN：",-1)),w("div",St,U(d.duplicateSns.join("、")),1)]),_:1})):z("",!0)]),_:1})]),_:1},8,["modelValue"])])}}}),Dt=ct(wt,[["__scopeId","data-v-c168aa68"]]);export{Dt as default};
