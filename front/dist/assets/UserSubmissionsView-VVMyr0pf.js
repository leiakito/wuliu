import{y as O,d as ue,u as ie,j as de,r as V,a as E,k as ce,z as me,c as T,e as g,b as t,w as a,g as m,t as v,f as p,n as A,m as I,F as pe,s as ge,v as be,x as fe,E as h,o as C,_ as _e}from"./index-D4luNJRO.js";const ve=k=>O.post("/user-submissions",k),ye=k=>O.get("/user-submissions/mine",{params:k}),we=k=>O.get("/user-submissions",{params:k}),ke={class:"page submissions-page"},Ne={class:"page-header"},Se={key:0},Ce=ue({__name:"UserSubmissionsView",setup(k){const Q=ie(),y=de(()=>{var l;return((l=Q.user)==null?void 0:l.role)==="ADMIN"}),U=[{label:"待处理",value:"PENDING",type:"warning"},{label:"处理中",value:"PROCESSING",type:"info"},{label:"已完成",value:"COMPLETED",type:"success"}],P=l=>{const e=U.find(o=>o.value===l);return e?e.label:"待处理"},H=l=>{const e=U.find(o=>o.value===l);return(e==null?void 0:e.type)??"warning"},R=[{value:"PAID",label:"已打款",tag:"success"},{value:"UNPAID",label:"未打款",tag:"warning"},{value:"NOT_RECEIVED",label:"未收货",tag:"info"}],M=l=>{var e;return((e=R.find(o=>o.value===l))==null?void 0:e.label)??"未知"},J=l=>{var e;return((e=R.find(o=>o.value===l))==null?void 0:e.tag)??"info"},x=V(),w=E({trackingNumber:""}),K={trackingNumber:[{required:!0,message:"请输入单号",trigger:"blur"}]},z=V(!1),D=V(!1),L=V(!1),N=V([]),c=E({page:1,size:10,total:0}),r=E({status:"",trackingNumber:"",username:""}),W=()=>({page:c.page,size:c.size,status:r.status||void 0,trackingNumber:r.trackingNumber?r.trackingNumber.trim():void 0,username:y.value&&r.username?r.username.trim():void 0}),S=async()=>{D.value=!0;try{const l=W(),e=y.value?await we(l):await ye(l);N.value=e.records,c.total=e.total}finally{D.value=!1}},X=async()=>{var o,_;if(!x.value)return;try{await x.value.validate()}catch{return}const l=w.trackingNumber.trim();if(!l)return;if(N.value.some(u=>{var i;return((i=u.trackingNumber)==null?void 0:i.trim().toUpperCase())===l.toUpperCase()})){h.warning("该单号已提交，请勿重复提交");return}w.trackingNumber=l,z.value=!0;try{await ve(w),h.success("提交成功"),j(),await S()}catch(u){const i=((_=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:_.message)??"提交失败，请稍后重试";h.error(i)}finally{z.value=!1}},j=()=>{var l;w.trackingNumber="",(l=x.value)==null||l.clearValidate()},B=()=>{c.page=1,S()},Y=()=>{r.status="",r.trackingNumber="",r.username="",B()},Z=l=>{c.page=l,S()},ee=l=>{c.size=l,c.page=1,S()},F=l=>l?l.replace("T"," ").slice(0,19):"-",G=l=>l?l.replace("T"," ").slice(0,19):"-",te=()=>{if(!N.value.length){h.info("暂无可导出的记录");return}L.value=!0;try{const l=["下单日期","订单时间","单号","型号","物流公司","订单状态","提交状态","提交时间"],e=N.value.map(b=>{const n=b.order;return[(n==null?void 0:n.orderDate)??"-",G(n==null?void 0:n.orderTime),b.trackingNumber??"-",(n==null?void 0:n.model)??"-",(n==null?void 0:n.category)??"-",M(n==null?void 0:n.status),P(b.status),F(b.createdAt)]}),o=[l,...e].map(b=>b.map(n=>`"${String(n??"").replace(/"/g,'""')}"`).join(",")).join(`
`),_=new Blob([o],{type:"application/vnd.ms-excel"}),u=window.URL.createObjectURL(_),i=document.createElement("a");i.href=u,i.download=`submissions-${new Date().toISOString().slice(0,10)}.xls`,i.click(),window.URL.revokeObjectURL(u)}finally{L.value=!1}};return ce(y,()=>{c.page=1,S()}),me(()=>{S()}),(l,e)=>{const o=p("el-tag"),_=p("el-input"),u=p("el-form-item"),i=p("el-button"),b=p("el-form"),n=p("el-card"),$=p("el-col"),ae=p("el-row"),le=p("el-option"),se=p("el-select"),f=p("el-table-column"),ne=p("el-table"),oe=p("el-pagination"),re=fe("loading");return C(),T("div",ke,[g("div",Ne,[e[6]||(e[6]=g("div",null,[g("h2",null,"单号提交"),g("p",{class:"sub"},"提交后即可在下方列表中查看处理进度")],-1)),t(o,{type:"info"},{default:a(()=>[m(v(y.value?"管理员视图":"个人视图"),1)]),_:1})]),t(ae,{gutter:16,class:"form-row"},{default:a(()=>[t($,{xs:24,md:12},{default:a(()=>[t(n,null,{header:a(()=>[...e[7]||(e[7]=[g("div",{class:"card-header"},[g("span",null,"提交单号"),g("small",null,"系统会自动匹配订单信息")],-1)])]),default:a(()=>[t(b,{ref_key:"formRef",ref:x,model:w,rules:K,"label-width":"90px"},{default:a(()=>[t(u,{label:"单号",prop:"trackingNumber"},{default:a(()=>[t(_,{modelValue:w.trackingNumber,"onUpdate:modelValue":e[0]||(e[0]=s=>w.trackingNumber=s),modelModifiers:{trim:!0},placeholder:"请输入或粘贴物流单号"},null,8,["modelValue"])]),_:1}),t(u,null,{default:a(()=>[t(i,{type:"primary",loading:z.value,onClick:X},{default:a(()=>[...e[8]||(e[8]=[m("提交单号",-1)])]),_:1},8,["loading"]),t(i,{onClick:j},{default:a(()=>[...e[9]||(e[9]=[m("清空",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),t($,{xs:24,md:12},{default:a(()=>[t(n,{class:"tips-card"},{header:a(()=>[...e[10]||(e[10]=[g("div",{class:"card-header"},[g("span",null,"操作说明")],-1)])]),default:a(()=>[g("ul",null,[e[11]||(e[11]=g("li",null,"状态默认为「待处理」，运营/财务确认后会更新状态",-1)),e[12]||(e[12]=g("li",null,"系统自动关联订单金额、型号、物流公司等信息",-1)),y.value?(C(),T("li",Se,"管理员可使用下方筛选器按用户名或状态查询所有提交")):A("",!0)])]),_:1})]),_:1})]),_:1}),t(n,{class:"filter-card"},{default:a(()=>[t(b,{inline:!0,model:r},{default:a(()=>[t(u,{label:"状态"},{default:a(()=>[t(se,{modelValue:r.status,"onUpdate:modelValue":e[1]||(e[1]=s=>r.status=s),placeholder:"全部",clearable:"",style:{width:"160px"}},{default:a(()=>[(C(),T(pe,null,ge(U,s=>t(le,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"单号"},{default:a(()=>[t(_,{modelValue:r.trackingNumber,"onUpdate:modelValue":e[2]||(e[2]=s=>r.trackingNumber=s),placeholder:"支持模糊搜索",clearable:""},null,8,["modelValue"])]),_:1}),y.value?(C(),I(u,{key:0,label:"用户名"},{default:a(()=>[t(_,{modelValue:r.username,"onUpdate:modelValue":e[3]||(e[3]=s=>r.username=s),placeholder:"仅管理员可筛选",clearable:""},null,8,["modelValue"])]),_:1})):A("",!0),t(u,null,{default:a(()=>[t(i,{type:"primary",onClick:B},{default:a(()=>[...e[13]||(e[13]=[m("查询",-1)])]),_:1}),t(i,{onClick:Y},{default:a(()=>[...e[14]||(e[14]=[m("重置",-1)])]),_:1}),t(i,{text:"",loading:L.value,disabled:!N.value.length,onClick:te},{default:a(()=>[...e[15]||(e[15]=[m("导出 Excel",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"])]),_:1}),t(n,{class:"table-card"},{default:a(()=>[be((C(),I(ne,{data:N.value,style:{width:"100%"}},{default:a(()=>[y.value?(C(),I(f,{key:0,prop:"username",label:"用户名",width:"140"})):A("",!0),t(f,{label:"下单日期",width:"140"},{default:a(({row:s})=>{var d;return[m(v(((d=s.order)==null?void 0:d.orderDate)??"-"),1)]}),_:1}),t(f,{label:"订单时间",width:"180"},{default:a(({row:s})=>{var d;return[m(v(G((d=s.order)==null?void 0:d.orderTime)),1)]}),_:1}),t(f,{prop:"trackingNumber",label:"单号","min-width":"160"}),t(f,{label:"型号","min-width":"160"},{default:a(({row:s})=>{var d;return[m(v(((d=s.order)==null?void 0:d.model)??"-"),1)]}),_:1}),t(f,{label:"物流公司",width:"120"},{default:a(({row:s})=>{var d;return[m(v(((d=s.order)==null?void 0:d.category)??"-"),1)]}),_:1}),t(f,{label:"订单状态",width:"140"},{default:a(({row:s})=>{var d;return[t(o,{type:J((d=s.order)==null?void 0:d.status)},{default:a(()=>{var q;return[m(v(M((q=s.order)==null?void 0:q.status)),1)]}),_:2},1032,["type"])]}),_:1}),t(f,{prop:"status",label:"提交状态",width:"140"},{default:a(({row:s})=>[t(o,{type:H(s.status)},{default:a(()=>[m(v(P(s.status)),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"createdAt",label:"提交时间",width:"180"},{default:a(({row:s})=>[m(v(F(s.createdAt)),1)]),_:1})]),_:1},8,["data"])),[[re,D.value]]),t(oe,{"current-page":c.page,"onUpdate:currentPage":e[4]||(e[4]=s=>c.page=s),"page-size":c.size,"onUpdate:pageSize":e[5]||(e[5]=s=>c.size=s),total:c.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",background:"",class:"table-pagination",onCurrentChange:Z,onSizeChange:ee},null,8,["current-page","page-size","total"])]),_:1})])}}}),xe=_e(Ce,[["__scopeId","data-v-9e579d9b"]]);export{xe as default};
