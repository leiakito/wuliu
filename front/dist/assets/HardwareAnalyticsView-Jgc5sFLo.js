import{f as I}from"./hardware-DBru1c0w.js";import{d as O,a as j,r as L,k as f,c as d,h as r,b as o,w as n,e as u,E as q,o as c,i as w,J as D,P as V,p as P,q as J,x as h,Q,R as T,_ as W}from"./index-DVwYDEL5.js";const G={class:"page"},K={class:"page-header"},X={class:"actions"},Z={class:"chart-header"},ee={key:0,class:"muted"},te={key:0,class:"chart-wrap"},ae=["viewBox"],le=["points"],oe=["cx","cy"],se=["x","y"],ne={class:"chart-axis"},re={key:1,class:"empty"},ce=O({__name:"HardwareAnalyticsView",setup(ie){const l=j({range:[],itemName:"",keyword:""}),x=L(!1),b=L([]),C=f(()=>Array.from(new Set(b.value.map(e=>e.itemName))).sort()),S=f(()=>{var i,m;const e=(i=l.itemName)==null?void 0:i.trim(),t=(m=l.keyword)==null?void 0:m.trim().toLowerCase();let s=b.value;return t?s=s.filter(_=>_.itemName.toLowerCase().includes(t)):e&&(s=s.filter(_=>_.itemName===e)),s}),p=f(()=>{const e=new Map;return S.value.forEach(s=>{const i=`${s.itemName}__${s.priceDate}`;e.set(i,s)}),[...Array.from(e.values())].sort((s,i)=>s.priceDate.localeCompare(i.priceDate))}),M=f(()=>Math.max(p.value.length*80,320)),B=f(()=>{const e=p.value;if(!e.length)return[];const t=e.map(v=>Number(v.price)||0),s=Math.max(...t,1),i=Math.min(...t,0),m=s-i||1,_=M.value/Math.max(e.length-1,1);return e.map((v,N)=>{const y=200-(Number(v.price)-i)/m*160+10;return{x:N*_,y,price:A(v.price)}})}),Y=f(()=>B.value.map(e=>`${e.x},${e.y}`).join(" ")),H=f(()=>l.itemName||C.value[0]||""),A=e=>(Number(e)||0).toFixed(2),R=()=>{const e=new Date,t=new Date;return t.setDate(e.getDate()-29),[F(t),F(e)]},F=e=>e.toISOString().slice(0,10),k=async()=>{x.value=!0;try{const e={};Array.isArray(l.range)&&l.range.length===2&&(e.startDate=l.range[0],e.endDate=l.range[1]),l.itemName&&(e.itemName=l.itemName),b.value=await I(e)}catch(e){console.error(e),q.error("加载价格数据失败")}finally{x.value=!1}},E=()=>{l.range=R(),l.itemName="",l.keyword="",k()};return E(),(e,t)=>{const s=u("el-button"),i=u("el-date-picker"),m=u("el-form-item"),_=u("el-option"),v=u("el-select"),N=u("el-input"),$=u("el-form"),y=u("el-card"),g=u("el-table-column"),U=u("el-table"),z=T("loading");return c(),d("div",G,[r("div",K,[t[4]||(t[4]=r("div",null,[r("h2",null,"硬件价格分析"),r("p",{class:"sub"},"按日期与型号查看价格走势")],-1)),r("div",X,[o(s,{onClick:k},{default:n(()=>[...t[3]||(t[3]=[w("刷新",-1)])]),_:1})])]),o(y,null,{default:n(()=>[o($,{inline:!0,model:l,class:"filter-form"},{default:n(()=>[o(m,{label:"日期范围"},{default:n(()=>[o(i,{modelValue:l.range,"onUpdate:modelValue":t[0]||(t[0]=a=>l.range=a),type:"daterange","value-format":"YYYY-MM-DD","start-placeholder":"开始","end-placeholder":"结束"},null,8,["modelValue"])]),_:1}),o(m,{label:"型号"},{default:n(()=>[o(v,{modelValue:l.itemName,"onUpdate:modelValue":t[1]||(t[1]=a=>l.itemName=a),placeholder:"选择型号",clearable:"",filterable:"",style:{width:"220px"}},{default:n(()=>[(c(!0),d(D,null,V(C.value,a=>(c(),P(_,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(m,{label:"型号搜索"},{default:n(()=>[o(N,{modelValue:l.keyword,"onUpdate:modelValue":t[2]||(t[2]=a=>l.keyword=a),placeholder:"输入型号关键字",clearable:"",style:{width:"220px"}},null,8,["modelValue"])]),_:1}),o(m,null,{default:n(()=>[o(s,{type:"primary",onClick:k},{default:n(()=>[...t[5]||(t[5]=[w("查询",-1)])]),_:1}),o(s,{onClick:E},{default:n(()=>[...t[6]||(t[6]=[w("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(y,{class:"chart-card"},{default:n(()=>[r("div",Z,[r("div",null,[r("strong",null,h(H.value||"请选择型号"),1),p.value.length?(c(),d("span",ee,"（"+h(p.value.length)+" 天数据）",1)):J("",!0)]),t[7]||(t[7]=r("div",{class:"muted"},"单位：元",-1))]),p.value.length?(c(),d("div",te,[(c(),d("svg",{viewBox:`0 0 ${M.value} 220`,preserveAspectRatio:"none",class:"chart"},[r("polyline",{points:Y.value,fill:"none",stroke:"#409EFF","stroke-width":"3"},null,8,le),(c(!0),d(D,null,V(B.value,a=>(c(),d("g",{key:a.x,class:"chart-point"},[r("circle",{cx:a.x,cy:a.y,r:"4",fill:"#409EFF"},null,8,oe),r("text",{x:a.x,y:a.y-10,"text-anchor":"middle",class:"chart-text"},h(a.price),9,se)]))),128))],8,ae)),r("div",ne,[(c(!0),d(D,null,V(p.value,a=>(c(),d("span",{key:a.priceDate},h(a.priceDate),1))),128))])])):(c(),d("div",re,"暂无数据，请调整筛选"))]),_:1}),o(y,{class:"table-card"},{default:n(()=>[Q((c(),P(U,{data:p.value,height:"420"},{default:n(()=>[o(g,{prop:"priceDate",label:"日期",width:"140"}),o(g,{prop:"itemName",label:"型号"}),o(g,{prop:"price",label:"价格",width:"140"},{default:n(({row:a})=>[w("￥"+h(A(a.price)),1)]),_:1}),o(g,{prop:"createdBy",label:"录入人",width:"140"})]),_:1},8,["data"])),[[z,x.value]])]),_:1})])}}}),me=W(ce,[["__scopeId","data-v-dd6ec075"]]);export{me as default};
