import{f as He,c as ce,d as ge,u as We,a as Xe,b as et,e as tt,j as lt,g as at,h as nt,i as ot}from"./settlements-DeGhIWQ5.js";import{l as st}from"./users-eHn9V8bz.js";import{l as rt}from"./submissions-C1J54hJM.js";import{d as it,u as dt,k as W,a as D,r as S,n as ve,M as ut,c as h,h as C,b as n,w as o,e as b,L as mt,o as w,i as p,p as U,q as B,J as z,P as X,Q as pt,R as ft,x as N,I as A,s as ct,E as f,T as F,_ as gt}from"./index-DSeUM942.js";const vt={class:"page"},bt={class:"page-header"},yt={class:"actions"},St=["onClick","title"],kt={style:{"margin-top":"8px","font-size":"12px",color:"#909399"}},wt={key:0,style:{color:"#f56c6c"}},Ct={style:{"margin-top":"8px","max-height":"100px","overflow-y":"auto"}},be="settlements-page-size",Vt=it({__name:"SettlementsView",setup(Nt){const ye=dt(),ee=W(()=>{var t;return((t=ye.user)==null?void 0:t.role)==="ADMIN"}),te=Number(localStorage.getItem(be))||50,s=D({status:"PENDING",ownerUsername:"",submitterUsername:"",trackingNumber:"",model:"",orderSn:"",dateRange:[],page:1,size:Number.isNaN(te)?50:te,sortProp:"orderTime",sortOrder:"ascending"}),_=S([]),L=S(0),R=S(!1),E=S(!1),j=S(),G=S(null),Y={prop:"orderTime",order:"ascending"},O=D({prop:Y.prop,order:Y.order}),g=S([]),le=S([]),Se=S([]),q=S([]),ae=S([]),Z=S(!1),ne=async()=>{Z.value=!0;try{const t=await rt({t:Date.now()});ae.value=t.sort((e,a)=>e.localeCompare(a))}catch(t){console.error("加载归属用户列表失败",t)}finally{Z.value=!1}},oe=S([]),J=S(!1),se=async()=>{J.value=!0;try{const t=await st();oe.value=t.filter(e=>e==null?void 0:e.username).sort((e,a)=>(e.username||"").localeCompare(a.username||""))}finally{J.value=!1}},c=D({visible:!1,loading:!1,targetId:0,form:{amount:0,remark:"",version:0}}),u=D({visible:!1,loading:!1,form:{model:"",amount:null,status:"",scope:"MODEL"}}),y=D({visible:!1,loading:!1,form:{amount:null,remark:""}}),m=D({visible:!1,loading:!1,form:{snInput:"",amount:null},parsedSns:[],duplicateSns:[]}),K=W(()=>{var e,a,r,i,d;const t={page:s.page,size:s.size,status:s.status||void 0,ownerUsername:((e=s.ownerUsername)==null?void 0:e.trim())||void 0,submitterUsername:((a=s.submitterUsername)==null?void 0:a.trim())||void 0,trackingNumber:((r=s.trackingNumber)==null?void 0:r.trim())||void 0,model:((i=s.model)==null?void 0:i.trim())||void 0,orderSn:((d=s.orderSn)==null?void 0:d.trim())||void 0,sortProp:s.sortProp||void 0,sortOrder:s.sortOrder||void 0};return Array.isArray(s.dateRange)&&s.dateRange.length===2&&(t.startDate=s.dateRange[0],t.endDate=s.dateRange[1]),t}),Q=W(()=>_.value),re=t=>t?t.replace(/\s+/g,""):"",v=async()=>{var t;R.value=!0;try{s.trackingNumber=re(s.trackingNumber),s.orderSn=re(s.orderSn),console.log("查询参数:",K.value);const e=await He(K.value);console.log("后端返回数据:",e),console.log("记录数量:",(t=e==null?void 0:e.records)==null?void 0:t.length,"总数:",e==null?void 0:e.total),_.value=e.records||[],L.value=e.total||0,console.log("更新后的 records.value:",_.value.length),ke(),Ne()}finally{R.value=!1}},ke=()=>{const t=new Set,e=new Set;_.value.forEach(a=>{a.model&&e.add(a.model),a.ownerUsername&&t.add(a.ownerUsername)}),Se.value=Array.from(t).sort((a,r)=>a.localeCompare(r)),q.value=Array.from(e).sort((a,r)=>a.localeCompare(r))},ie=()=>{_.value=[],L.value=0,s.status="",s.ownerUsername="",s.submitterUsername="",s.trackingNumber="",s.model="",s.orderSn="",s.dateRange=[],s.page=1,v()},H=()=>{ie()},we=t=>{s.size=t,localStorage.setItem(be,String(t)),s.page=1,v()},Ce=t=>{s.page=t,v()},Ve=t=>{le.value=t,g.value=t.map(e=>e.id)},Ne=()=>{if(Q.value.length>0){const t=Q.value[0];G.value=t,mt(()=>{var e;(e=j.value)==null||e.setCurrentRow(t)})}else G.value=null},Ue=()=>"",_e=t=>{O.prop=t.prop??"",O.order=t.order??null,s.sortProp=O.prop,s.sortOrder=O.order,s.page=1,v()},xe=t=>{var a;const e=g.value.includes(t.id);(a=j.value)==null||a.toggleRowSelection(t,!e)},De=async t=>{var a,r;const e=t.amount;if(!(e==null||e===0)&&t.status!=="CONFIRMED")try{const i={amount:e,remark:t.remark,version:t.version};await ce(t.id,i),t.status="CONFIRMED",t.version=(t.version||0)+1,f.success(`记录 ${t.trackingNumber||t.orderSn} 已确认`)}catch(i){console.error("快速确认失败:",i);const d=((r=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:r.message)||(i==null?void 0:i.message)||"";(d.includes("已被")||d.includes("修改"))&&f({type:"warning",message:"⚠️ 该记录已被其他用户修改，已自动刷新最新数据，请重新操作",duration:5e3,showClose:!0}),await v()}},he=()=>{u.form.scope=g.value.length?"SELECTION":"MODEL",u.form.model=q.value[0]??"",u.form.amount=null,u.form.status=s.status||"",u.visible=!0},Re=()=>{if(!g.value.length){f.info("请先选择结算记录");return}y.form.amount=null,y.form.remark="",y.visible=!0},Ee=t=>{c.visible=!0,c.targetId=t.id,c.form.amount=t.amount??0,c.form.remark=t.remark??"",c.form.version=t.version??0},Ie=async()=>{var t,e;if(c.targetId){c.loading=!0;try{const a={amount:c.form.amount,remark:c.form.remark,version:c.form.version};await ce(c.targetId,a),f.success("已确认"),c.visible=!1,v()}catch(a){const r=((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"";(r.includes("已被")||r.includes("修改"))&&f({type:"warning",message:"⚠️ 该记录已被其他用户修改，已自动刷新最新数据，请重新操作",duration:5e3,showClose:!0}),await v()}finally{c.loading=!1}}},Be=async()=>{if(!g.value.length){f.info("请选择记录");return}await F.confirm(`确认将选中的 ${g.value.length} 条记录移动到待结账吗？`,"提示",{type:"info",confirmButtonText:"确认移动",cancelButtonText:"取消"});const t=await lt(g.value);f.success(`已将 ${t} 条记录移动到待结账`),g.value=[],(s.status===""||s.status==="DRAFT")&&(s.status="PENDING"),v()},Fe=async()=>{if(!g.value.length){f.info("请选择记录");return}await F.confirm("确认删除选中的结算记录吗？","提示",{type:"warning"}),await ge(g.value),f.success("已删除"),g.value=[],v()},Oe=async t=>{try{await F.confirm("确认删除该结算记录吗？","二次确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"})}catch{return}try{await ge([t.id]),f.success("已删除"),v()}catch(e){console.error("删除失败:",e),f.error("删除失败")}},Me=async()=>{var t,e;if(u.form.amount===null||u.form.amount===void 0){f.warning("请输入金额");return}if(u.form.scope==="MODEL"){if(!u.form.model||!u.form.model.trim()){f.warning("请选择型号");return}u.loading=!0;try{const a={model:u.form.model.trim(),amount:u.form.amount,status:((t=u.form.status)==null?void 0:t.trim())||void 0,ownerUsername:((e=s.ownerUsername)==null?void 0:e.trim())||void 0};Array.isArray(s.dateRange)&&s.dateRange.length===2&&(a.startDate=s.dateRange[0],a.endDate=s.dateRange[1]),await We(a),f.success("批量价格已更新"),u.visible=!1,v()}finally{u.loading=!1}}else{if(!g.value.length){f.warning("请选择结算记录");return}u.loading=!0;try{const a=g.value.map(r=>{const i=_.value.find(k=>k.id===r),d={amount:u.form.amount,remark:void 0,version:(i==null?void 0:i.version)??0};return Xe(r,d)});await Promise.all(a),f.success("已更新所选记录金额"),u.visible=!1,v()}finally{u.loading=!1}}},Pe=async()=>{if(!g.value.length){f.info("请先选择结算记录");return}y.loading=!0;try{const t={ids:[...g.value],amount:y.form.amount??void 0,remark:y.form.remark||void 0};await et(t),f.success("批量确认成功"),y.visible=!1,g.value=[],le.value=[],v()}finally{y.loading=!1}},Te=()=>{m.form.snInput="",m.form.amount=null,m.parsedSns=[],m.duplicateSns=[],m.visible=!0},de=t=>t.split(/[\n,;]/).map(e=>e.trim()).filter(e=>e.length>0),ue=t=>{const e=new Set,a=new Set;return t.forEach(r=>{const i=r.toUpperCase();e.has(i)?a.add(r):e.add(i)}),Array.from(a)},$e=async()=>{const t=de(m.form.snInput),e=ue(t);if(m.parsedSns=t,m.duplicateSns=e,t.length===0){f.warning("请输入至少一个SN");return}if(m.form.amount===null||m.form.amount===void 0){f.warning("请输入金额");return}const a=t.filter(r=>!e.includes(r));if(a.length===0){f.warning("所有SN都重复，无法设置价格");return}m.loading=!0;try{const r={sns:a,amount:m.form.amount},i=await tt(r),d=(i==null?void 0:i.updatedCount)??0,k=(i==null?void 0:i.skippedSns)??[];let x=`已更新 ${d} 个SN的价格`;e.length>0&&(x+=`，跳过 ${e.length} 个重复输入的SN`),k&&k.length>0?(x+=`，跳过 ${k.length} 个已有价格的SN`,f.warning({message:`${x}
已有价格的SN: ${k.join("、")}`,duration:5e3,showClose:!0})):f.success(x),m.visible=!1,v()}finally{m.loading=!1}};ve(()=>m.form.snInput,t=>{const e=de(t),a=ue(e);m.parsedSns=e,m.duplicateSns=a});const me=async(t,e="待结账.xlsx")=>{const a=await ot(t),r=new Blob([a.data],{type:"application/octet-stream"}),i=window.URL.createObjectURL(r),d=document.createElement("a");d.href=i,d.download=e,d.click(),window.URL.revokeObjectURL(i)},ze=async()=>{var t,e;E.value=!0;try{const a={status:s.status||void 0,ownerUsername:((t=s.ownerUsername)==null?void 0:t.trim())||void 0,submitterUsername:((e=s.submitterUsername)==null?void 0:e.trim())||void 0};Array.isArray(s.dateRange)&&s.dateRange.length===2&&(a.startDate=s.dateRange[0],a.endDate=s.dateRange[1]),await me(a)}finally{E.value=!1}},Ae=async()=>{try{await F.confirm("导出后会删除已确认的数据，确定继续吗？","二次确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"})}catch{return}E.value=!0;try{const t={status:"CONFIRMED"},e=new Date,a=e.getMonth()+1,r=e.getDate(),i=`${a}月${r}日.xlsx`;await me(t,i);const d=await at();console.log(`已从数据库删除 ${d} 条已确认的记录`),f.success(`已导出并删除 ${d} 条已确认记录`),v()}catch(t){console.error("导出或删除失败:",t),f.error("导出或删除操作失败")}finally{E.value=!1}},Le=t=>t?t.replace("T"," ").replace("Z",""):"-",M=(t,e)=>{try{const a={tracking:{bg:t.trackingBgColor,fg:t.trackingFontColor,strike:t.trackingStrike},model:{bg:t.modelBgColor,fg:t.modelFontColor,strike:t.modelStrike},sn:{bg:t.snBgColor,fg:t.snFontColor,strike:t.snStrike},amount:{bg:t.amountBgColor,fg:t.amountFontColor,strike:t.amountStrike},remark:{bg:t.remarkBgColor,fg:t.remarkFontColor,strike:t.remarkStrike}}[e];if(!a)return{};const r={};return a.bg&&a.bg!=="#FFFFFF"&&a.bg!=="#FFF"&&String(a.bg).trim()!==""&&(r["background-color"]=a.bg),a.fg&&a.fg!=="#000000"&&a.fg!=="#000"&&String(a.fg).trim()!==""&&(r.color=a.fg),(a.strike===!0||a.strike==="true"||a.strike===1)&&(r["text-decoration"]="line-through"),r}catch(a){return console.warn("样式应用失败:",a),{}}},je=t=>{t&&navigator.clipboard.writeText(t).then(()=>{f.success("已复制")})};ve(ee,t=>{se(),ne()},{immediate:!0}),ut(()=>{se(),ne()});const Ge=async()=>{try{await F.confirm("这将根据当前筛选条件，确认所有待结账的记录（仅处理有金额的条目）。此操作不可撤销，确定继续吗？","确认全部操作",{confirmButtonText:"确定确认",cancelButtonText:"取消",type:"warning"})}catch{return}R.value=!0;try{const t={...K.value,status:"PENDING"};delete t.page,delete t.size;const e=await nt(t);f.success(`操作成功，已确认 ${e} 条记录。`),v()}catch(t){console.error("确认全部失败:",t)}finally{R.value=!1}};return v(),(t,e)=>{const a=b("el-button"),r=b("el-option"),i=b("el-select"),d=b("el-form-item"),k=b("el-input"),x=b("el-date-picker"),I=b("el-form"),pe=b("el-card"),V=b("el-table-column"),P=b("el-input-number"),Ye=b("el-tag"),qe=b("el-table"),Ze=b("el-pagination"),T=b("el-dialog"),fe=b("el-radio-button"),Je=b("el-radio-group"),Ke=b("el-alert"),Qe=ft("loading");return w(),h("div",vt,[C("div",bt,[e[34]||(e[34]=C("div",null,[C("h2",null,"结账管理"),C("p",{class:"sub"},"生成、确认与导出待结账记录")],-1)),C("div",yt,[n(a,{type:"primary",plain:"",onClick:he},{default:o(()=>[...e[26]||(e[26]=[p("批量设置价格",-1)])]),_:1}),n(a,{type:"success",plain:"",onClick:Ae},{default:o(()=>[...e[27]||(e[27]=[p(" 导出已确认数据 ",-1)])]),_:1}),n(a,{type:"primary",plain:"",onClick:Te},{default:o(()=>[...e[28]||(e[28]=[p("SN批量设置价格",-1)])]),_:1}),n(a,{type:"success",plain:"",disabled:!g.value.length,onClick:Re},{default:o(()=>[...e[29]||(e[29]=[p("批量确认",-1)])]),_:1},8,["disabled"]),n(a,{type:"warning",plain:"",onClick:Ge},{default:o(()=>[...e[30]||(e[30]=[p("确认全部",-1)])]),_:1}),n(a,{onClick:ze,loading:E.value},{default:o(()=>[...e[31]||(e[31]=[p("导出 Excel",-1)])]),_:1},8,["loading"]),n(a,{type:"info",plain:"",disabled:!g.value.length,onClick:Be},{default:o(()=>[...e[32]||(e[32]=[p(" 移动到待结账 ",-1)])]),_:1},8,["disabled"]),n(a,{type:"danger",plain:"",disabled:!g.value.length,onClick:Fe},{default:o(()=>[...e[33]||(e[33]=[p(" 删除所选 ",-1)])]),_:1},8,["disabled"])])]),n(pe,null,{default:o(()=>[n(I,{inline:!0,model:s,class:"filter-form"},{default:o(()=>[n(d,{label:"状态"},{default:o(()=>[n(i,{modelValue:s.status,"onUpdate:modelValue":e[0]||(e[0]=l=>s.status=l),clearable:"",placeholder:"全部",style:{width:"160px"}},{default:o(()=>[ee.value?(w(),U(r,{key:0,label:"草稿",value:"DRAFT"})):B("",!0),n(r,{label:"待结账",value:"PENDING"}),n(r,{label:"已确认",value:"CONFIRMED"})]),_:1},8,["modelValue"])]),_:1}),n(d,{label:"单号"},{default:o(()=>[n(k,{modelValue:s.trackingNumber,"onUpdate:modelValue":e[1]||(e[1]=l=>s.trackingNumber=l),placeholder:"输入单号",clearable:"",style:{width:"200px"},onClear:H},null,8,["modelValue"])]),_:1}),n(d,{label:"型号"},{default:o(()=>[n(k,{modelValue:s.model,"onUpdate:modelValue":e[2]||(e[2]=l=>s.model=l),placeholder:"输入型号",clearable:"",style:{width:"200px"},onClear:H},null,8,["modelValue"])]),_:1}),n(d,{label:"SN"},{default:o(()=>[n(k,{modelValue:s.orderSn,"onUpdate:modelValue":e[3]||(e[3]=l=>s.orderSn=l),placeholder:"输入 SN",clearable:"",style:{width:"200px"},onClear:H},null,8,["modelValue"])]),_:1}),n(d,{label:"日期"},{default:o(()=>[n(x,{modelValue:s.dateRange,"onUpdate:modelValue":e[4]||(e[4]=l=>s.dateRange=l),type:"daterange","value-format":"YYYY-MM-DD","start-placeholder":"开始","end-placeholder":"结束"},null,8,["modelValue"])]),_:1}),n(d,{label:"归属用户"},{default:o(()=>[n(i,{modelValue:s.ownerUsername,"onUpdate:modelValue":e[5]||(e[5]=l=>s.ownerUsername=l),placeholder:"全部",clearable:"",filterable:"",style:{width:"200px"},loading:Z.value},{default:o(()=>[(w(!0),h(z,null,X(ae.value,l=>(w(),U(r,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),n(d,{label:"提交人"},{default:o(()=>[n(i,{modelValue:s.submitterUsername,"onUpdate:modelValue":e[6]||(e[6]=l=>s.submitterUsername=l),placeholder:"全部",clearable:"",filterable:"",style:{width:"200px"},loading:J.value},{default:o(()=>[(w(!0),h(z,null,X(oe.value,l=>(w(),U(r,{key:l.username,label:l.fullName?`${l.fullName}（${l.username}）`:l.username,value:l.username},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),n(d,null,{default:o(()=>[n(a,{type:"primary",onClick:v},{default:o(()=>[...e[35]||(e[35]=[p("查询",-1)])]),_:1}),n(a,{onClick:ie},{default:o(()=>[...e[36]||(e[36]=[p("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),n(pe,{class:"table-card"},{default:o(()=>[pt((w(),U(qe,{ref_key:"tableRef",ref:j,data:Q.value,height:"520","default-sort":Y,"highlight-current-row":"","current-row":G.value,"row-class-name":Ue,onSelectionChange:Ve,onRowClick:xe,onSortChange:_e},{default:o(()=>[n(V,{type:"selection",width:"48"}),n(V,{prop:"orderTime",label:"下单时间",width:"180",sortable:"custom","sort-orders":["ascending","descending"]},{default:o(({row:l})=>[p(N(Le(l.orderTime)),1)]),_:1}),n(V,{prop:"trackingNumber",label:"单号",width:"180",sortable:"custom","sort-orders":["ascending","descending"]},{default:o(({row:l})=>[C("span",{style:A(M(l,"tracking"))},N(l.trackingNumber),5)]),_:1}),n(V,{prop:"model",label:"型号",width:"280"},{default:o(({row:l})=>[C("span",{style:A(M(l,"model"))},N(l.model||"-"),5)]),_:1}),n(V,{prop:"orderSn",label:"SN",width:"180"},{default:o(({row:l})=>[C("span",{style:A(M(l,"sn")),class:ct([{"sn-wrap":l.orderSn&&l.orderSn.length>7},"sn-cell"]),onClick:$=>je(l.orderSn),title:l.orderSn?"点击复制":""},N(l.orderSn||"-"),15,St)]),_:1}),n(V,{prop:"amount",label:"结账金额",width:"180",sortable:"custom","sort-orders":["ascending","descending"]},{default:o(({row:l})=>[n(P,{modelValue:l.amount,"onUpdate:modelValue":$=>l.amount=$,min:0,step:10,size:"small",controls:!1,placeholder:"输入金额确认",style:{width:"100%"},onBlur:()=>De(l)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),n(V,{prop:"ownerUsername",label:"归属人",width:"100"},{default:o(({row:l})=>[p(N(l.ownerUsername||"-"),1)]),_:1}),n(V,{prop:"submitterUsername",label:"提交人",width:"100"},{default:o(({row:l})=>[p(N(l.submitterUsername||"-"),1)]),_:1}),n(V,{prop:"status",label:"状态",width:"100",sortable:"custom","sort-orders":["ascending","descending"]},{default:o(({row:l})=>[n(Ye,{type:l.status==="CONFIRMED"?"success":"warning"},{default:o(()=>[p(N(l.status==="CONFIRMED"?"已确认":"待结账"),1)]),_:2},1032,["type"])]),_:1}),n(V,{prop:"remark",label:"备注"},{default:o(({row:l})=>[C("span",{style:A(M(l,"remark"))},N(l.remark||"-"),5)]),_:1}),n(V,{label:"操作",width:"160"},{default:o(({row:l})=>[l.status!=="CONFIRMED"?(w(),U(a,{key:0,link:"",type:"primary",onClick:$=>Ee(l)},{default:o(()=>[...e[37]||(e[37]=[p(" 确认 ",-1)])]),_:1},8,["onClick"])):B("",!0),n(a,{link:"",type:"danger",onClick:$=>Oe(l)},{default:o(()=>[...e[38]||(e[38]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","current-row"])),[[Qe,R.value]]),n(Ze,{"current-page":s.page,"onUpdate:currentPage":e[7]||(e[7]=l=>s.page=l),"page-size":s.size,"onUpdate:pageSize":e[8]||(e[8]=l=>s.size=l),total:L.value,layout:"total, sizes, prev, pager, next","page-sizes":[20,50,100,200],style:{"margin-top":"12px","justify-content":"flex-end"},onSizeChange:we,onCurrentChange:Ce},null,8,["current-page","page-size","total"])]),_:1}),n(T,{modelValue:c.visible,"onUpdate:modelValue":e[12]||(e[12]=l=>c.visible=l),title:"确认结账",width:"480px","destroy-on-close":!0},{footer:o(()=>[n(a,{onClick:e[11]||(e[11]=l=>c.visible=!1)},{default:o(()=>[...e[39]||(e[39]=[p("取消",-1)])]),_:1}),n(a,{type:"primary",loading:c.loading,onClick:Ie},{default:o(()=>[...e[40]||(e[40]=[p("确认",-1)])]),_:1},8,["loading"])]),default:o(()=>[n(I,{"label-width":"100px"},{default:o(()=>[n(d,{label:"金额"},{default:o(()=>[n(P,{modelValue:c.form.amount,"onUpdate:modelValue":e[9]||(e[9]=l=>c.form.amount=l),min:0,step:10,controls:!1,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),n(d,{label:"备注"},{default:o(()=>[n(k,{modelValue:c.form.remark,"onUpdate:modelValue":e[10]||(e[10]=l=>c.form.remark=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(T,{modelValue:u.visible,"onUpdate:modelValue":e[18]||(e[18]=l=>u.visible=l),title:"批量设置价格",width:"420px","destroy-on-close":!0},{footer:o(()=>[n(a,{onClick:e[17]||(e[17]=l=>u.visible=!1)},{default:o(()=>[...e[43]||(e[43]=[p("取消",-1)])]),_:1}),n(a,{type:"primary",loading:u.loading,onClick:Me},{default:o(()=>[...e[44]||(e[44]=[p("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[n(I,{"label-width":"100px"},{default:o(()=>[n(d,{label:"作用范围"},{default:o(()=>[n(Je,{modelValue:u.form.scope,"onUpdate:modelValue":e[13]||(e[13]=l=>u.form.scope=l)},{default:o(()=>[n(fe,{label:"MODEL"},{default:o(()=>[...e[41]||(e[41]=[p("按型号筛选",-1)])]),_:1}),n(fe,{label:"SELECTION",disabled:!g.value.length},{default:o(()=>[...e[42]||(e[42]=[p("已选择记录",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),u.form.scope==="MODEL"?(w(),h(z,{key:0},[n(d,{label:"型号"},{default:o(()=>[n(i,{modelValue:u.form.model,"onUpdate:modelValue":e[14]||(e[14]=l=>u.form.model=l),placeholder:"请选择型号",filterable:"","allow-create":""},{default:o(()=>[(w(!0),h(z,null,X(q.value,l=>(w(),U(r,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(d,{label:"状态范围"},{default:o(()=>[n(i,{modelValue:u.form.status,"onUpdate:modelValue":e[15]||(e[15]=l=>u.form.status=l),placeholder:"全部",clearable:"",style:{width:"200px"}},{default:o(()=>[n(r,{label:"待结账",value:"PENDING"}),n(r,{label:"已确认",value:"CONFIRMED"})]),_:1},8,["modelValue"])]),_:1})],64)):B("",!0),n(d,{label:"金额"},{default:o(()=>[n(P,{modelValue:u.form.amount,"onUpdate:modelValue":e[16]||(e[16]=l=>u.form.amount=l),min:0,step:10,controls:!1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(T,{modelValue:y.visible,"onUpdate:modelValue":e[21]||(e[21]=l=>y.visible=l),title:"批量确认",width:"420px","destroy-on-close":!0},{footer:o(()=>[n(a,{onClick:e[20]||(e[20]=l=>y.visible=!1)},{default:o(()=>[...e[45]||(e[45]=[p("取消",-1)])]),_:1}),n(a,{type:"primary",loading:y.loading,onClick:Pe},{default:o(()=>[...e[46]||(e[46]=[p("确认",-1)])]),_:1},8,["loading"])]),default:o(()=>[n(I,{"label-width":"100px"},{default:o(()=>[n(d,{label:"备注"},{default:o(()=>[n(k,{modelValue:y.form.remark,"onUpdate:modelValue":e[19]||(e[19]=l=>y.form.remark=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(T,{modelValue:m.visible,"onUpdate:modelValue":e[25]||(e[25]=l=>m.visible=l),title:"SN批量设置价格",width:"520px","destroy-on-close":!0},{footer:o(()=>[n(a,{onClick:e[24]||(e[24]=l=>m.visible=!1)},{default:o(()=>[...e[48]||(e[48]=[p("取消",-1)])]),_:1}),n(a,{type:"primary",loading:m.loading,onClick:$e,disabled:m.parsedSns.length===0},{default:o(()=>[...e[49]||(e[49]=[p("保存",-1)])]),_:1},8,["loading","disabled"])]),default:o(()=>[n(I,{"label-width":"100px"},{default:o(()=>[n(d,{label:"SN列表"},{default:o(()=>[n(k,{modelValue:m.form.snInput,"onUpdate:modelValue":e[22]||(e[22]=l=>m.form.snInput=l),type:"textarea",rows:6,placeholder:"支持多个SN，使用换行/逗号/分号分隔"},null,8,["modelValue"]),C("div",kt,[p(" 已识别 "+N(m.parsedSns.length)+" 个SN ",1),m.duplicateSns.length>0?(w(),h("span",wt," (发现 "+N(m.duplicateSns.length)+" 个重复) ",1)):B("",!0)])]),_:1}),n(d,{label:"金额"},{default:o(()=>[n(P,{modelValue:m.form.amount,"onUpdate:modelValue":e[23]||(e[23]=l=>m.form.amount=l),min:0,step:10,controls:!1},null,8,["modelValue"])]),_:1}),m.duplicateSns.length>0?(w(),U(Ke,{key:0,type:"warning",closable:!1,style:{"margin-bottom":"12px"}},{title:o(()=>[e[47]||(e[47]=C("div",null,"检测到重复SN，将跳过以下SN：",-1)),C("div",Ct,N(m.duplicateSns.join("、")),1)]),_:1})):B("",!0)]),_:1})]),_:1},8,["modelValue"])])}}}),ht=gt(Vt,[["__scopeId","data-v-ba05c31b"]]);export{ht as default};
