import{f as He,c as ce,d as ge,u as We,a as Xe,b as et,e as tt,j as lt,g as at,h as ot,i as nt}from"./settlements-bV1gEBZA.js";import{l as rt}from"./users-iWmjUf7j.js";import{l as st}from"./submissions-DVKte-tD.js";import{d as it,u as dt,k as W,a as _,r as k,n as be,M as ut,c as D,h as C,b as a,w as n,e as b,L as mt,o as S,i as m,p as U,q as F,J as $,P as X,Q as pt,R as ft,x as N,I as z,E as p,T as O,_ as ct}from"./index-DVwYDEL5.js";const gt={class:"page"},bt={class:"page-header"},vt={class:"actions"},yt={style:{"margin-top":"8px","font-size":"12px",color:"#909399"}},kt={key:0,style:{color:"#f56c6c"}},St={style:{"margin-top":"8px","max-height":"100px","overflow-y":"auto"}},ve="settlements-page-size",wt=it({__name:"SettlementsView",setup(Ct){const ye=dt(),ee=W(()=>{var t;return((t=ye.user)==null?void 0:t.role)==="ADMIN"}),te=Number(localStorage.getItem(ve))||50,r=_({status:"PENDING",ownerUsername:"",submitterUsername:"",trackingNumber:"",model:"",orderSn:"",dateRange:[],page:1,size:Number.isNaN(te)?50:te,sortProp:"orderTime",sortOrder:"ascending"}),h=k([]),L=k(0),R=k(!1),E=k(!1),j=k(),G=k(null),Y={prop:"orderTime",order:"ascending"},P=_({prop:Y.prop,order:Y.order}),c=k([]),le=k([]),ke=k([]),q=k([]),ae=k([]),Z=k(!1),oe=async()=>{Z.value=!0;try{const t=await st({t:Date.now()});ae.value=t.sort((e,o)=>e.localeCompare(o))}catch(t){console.error("加载归属用户列表失败",t)}finally{Z.value=!1}},ne=k([]),J=k(!1),re=async()=>{J.value=!0;try{const t=await rt();ne.value=t.filter(e=>e==null?void 0:e.username).sort((e,o)=>(e.username||"").localeCompare(o.username||""))}finally{J.value=!1}},g=_({visible:!1,loading:!1,targetId:0,form:{amount:0,remark:""}}),i=_({visible:!1,loading:!1,form:{model:"",amount:null,status:"",scope:"MODEL"}}),y=_({visible:!1,loading:!1,form:{amount:null,remark:""}}),d=_({visible:!1,loading:!1,form:{snInput:"",amount:null},parsedSns:[],duplicateSns:[]}),K=W(()=>{var e,o,s,f,u;const t={page:r.page,size:r.size,status:r.status||void 0,ownerUsername:((e=r.ownerUsername)==null?void 0:e.trim())||void 0,submitterUsername:((o=r.submitterUsername)==null?void 0:o.trim())||void 0,trackingNumber:((s=r.trackingNumber)==null?void 0:s.trim())||void 0,model:((f=r.model)==null?void 0:f.trim())||void 0,orderSn:((u=r.orderSn)==null?void 0:u.trim())||void 0,sortProp:r.sortProp||void 0,sortOrder:r.sortOrder||void 0};return Array.isArray(r.dateRange)&&r.dateRange.length===2&&(t.startDate=r.dateRange[0],t.endDate=r.dateRange[1]),t}),Q=W(()=>h.value),se=t=>t?t.replace(/\s+/g,""):"",v=async()=>{var t;R.value=!0;try{r.trackingNumber=se(r.trackingNumber),r.orderSn=se(r.orderSn),console.log("查询参数:",K.value);const e=await He(K.value);console.log("后端返回数据:",e),console.log("记录数量:",(t=e==null?void 0:e.records)==null?void 0:t.length,"总数:",e==null?void 0:e.total),h.value=e.records||[],L.value=e.total||0,console.log("更新后的 records.value:",h.value.length),Se(),Ne()}finally{R.value=!1}},Se=()=>{const t=new Set,e=new Set;h.value.forEach(o=>{o.model&&e.add(o.model),o.ownerUsername&&t.add(o.ownerUsername)}),ke.value=Array.from(t).sort((o,s)=>o.localeCompare(s)),q.value=Array.from(e).sort((o,s)=>o.localeCompare(s))},ie=()=>{h.value=[],L.value=0,r.status="",r.ownerUsername="",r.submitterUsername="",r.trackingNumber="",r.model="",r.orderSn="",r.dateRange=[],r.page=1,v()},H=()=>{ie()},we=t=>{r.size=t,localStorage.setItem(ve,String(t)),r.page=1,v()},Ce=t=>{r.page=t,v()},Ve=t=>{le.value=t,c.value=t.map(e=>e.id)},Ne=()=>{if(Q.value.length>0){const t=Q.value[0];G.value=t,mt(()=>{var e;(e=j.value)==null||e.setCurrentRow(t)})}else G.value=null},Ue=()=>"",xe=t=>{P.prop=t.prop??"",P.order=t.order??null,r.sortProp=P.prop,r.sortOrder=P.order,r.page=1,v()},_e=t=>{var o;const e=c.value.includes(t.id);(o=j.value)==null||o.toggleRowSelection(t,!e)},De=async(t,e,o)=>{if(e!=null&&e!==o)try{const s={amount:e,remark:t.remark};await ce(t.id,s),t.status="CONFIRMED",t.amount=e,p.success(`记录 ${t.trackingNumber||t.orderSn} 已确认`)}catch(s){console.error("快速确认失败:",s),t.amount=o,p.error("确认失败，请重试")}},he=()=>{i.form.scope=c.value.length?"SELECTION":"MODEL",i.form.model=q.value[0]??"",i.form.amount=null,i.form.status=r.status||"",i.visible=!0},Re=()=>{if(!c.value.length){p.info("请先选择结算记录");return}y.form.amount=null,y.form.remark="",y.visible=!0},Ee=t=>{g.visible=!0,g.targetId=t.id,g.form.amount=t.amount??0,g.form.remark=t.remark??""},Ie=async()=>{if(g.targetId){g.loading=!0;try{const t={amount:g.form.amount,remark:g.form.remark};await ce(g.targetId,t),p.success("已确认"),g.visible=!1,v()}finally{g.loading=!1}}},Be=async()=>{if(!c.value.length){p.info("请选择记录");return}await O.confirm(`确认将选中的 ${c.value.length} 条记录移动到待结账吗？`,"提示",{type:"info",confirmButtonText:"确认移动",cancelButtonText:"取消"});const t=await lt(c.value);p.success(`已将 ${t} 条记录移动到待结账`),c.value=[],(r.status===""||r.status==="DRAFT")&&(r.status="PENDING"),v()},Fe=async()=>{if(!c.value.length){p.info("请选择记录");return}await O.confirm("确认删除选中的结算记录吗？","提示",{type:"warning"}),await ge(c.value),p.success("已删除"),c.value=[],v()},Oe=async t=>{try{await O.confirm("确认删除该结算记录吗？","二次确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"})}catch{return}try{await ge([t.id]),p.success("已删除"),v()}catch(e){console.error("删除失败:",e),p.error("删除失败")}},Pe=async()=>{var t,e;if(i.form.amount===null||i.form.amount===void 0){p.warning("请输入金额");return}if(i.form.scope==="MODEL"){if(!i.form.model||!i.form.model.trim()){p.warning("请选择型号");return}i.loading=!0;try{const o={model:i.form.model.trim(),amount:i.form.amount,status:((t=i.form.status)==null?void 0:t.trim())||void 0,ownerUsername:((e=r.ownerUsername)==null?void 0:e.trim())||void 0};Array.isArray(r.dateRange)&&r.dateRange.length===2&&(o.startDate=r.dateRange[0],o.endDate=r.dateRange[1]),await We(o),p.success("批量价格已更新"),i.visible=!1,v()}finally{i.loading=!1}}else{if(!c.value.length){p.warning("请选择结算记录");return}i.loading=!0;try{const o={amount:i.form.amount,remark:void 0};await Promise.all(c.value.map(s=>Xe(s,o))),p.success("已更新所选记录金额"),i.visible=!1,v()}finally{i.loading=!1}}},Me=async()=>{if(!c.value.length){p.info("请先选择结算记录");return}y.loading=!0;try{const t={ids:[...c.value],amount:y.form.amount??void 0,remark:y.form.remark||void 0};await et(t),p.success("批量确认成功"),y.visible=!1,c.value=[],le.value=[],v()}finally{y.loading=!1}},Te=()=>{d.form.snInput="",d.form.amount=null,d.parsedSns=[],d.duplicateSns=[],d.visible=!0},de=t=>t.split(/[\n,;]/).map(e=>e.trim()).filter(e=>e.length>0),ue=t=>{const e=new Set,o=new Set;return t.forEach(s=>{const f=s.toUpperCase();e.has(f)?o.add(s):e.add(f)}),Array.from(o)},Ae=async()=>{const t=de(d.form.snInput),e=ue(t);if(d.parsedSns=t,d.duplicateSns=e,t.length===0){p.warning("请输入至少一个SN");return}if(d.form.amount===null||d.form.amount===void 0){p.warning("请输入金额");return}const o=t.filter(s=>!e.includes(s));if(o.length===0){p.warning("所有SN都重复，无法设置价格");return}d.loading=!0;try{const s={sns:o,amount:d.form.amount},f=await tt(s),u=(f==null?void 0:f.updatedCount)??0,V=(f==null?void 0:f.skippedSns)??[];let x=`已更新 ${u} 个SN的价格`;e.length>0&&(x+=`，跳过 ${e.length} 个重复输入的SN`),V&&V.length>0?(x+=`，跳过 ${V.length} 个已有价格的SN`,p.warning({message:`${x}
已有价格的SN: ${V.join("、")}`,duration:5e3,showClose:!0})):p.success(x),d.visible=!1,v()}finally{d.loading=!1}};be(()=>d.form.snInput,t=>{const e=de(t),o=ue(e);d.parsedSns=e,d.duplicateSns=o});const me=async(t,e="settlements.xlsx")=>{const o=await nt(t),s=new Blob([o.data],{type:"application/octet-stream"}),f=window.URL.createObjectURL(s),u=document.createElement("a");u.href=f,u.download=e,u.click(),window.URL.revokeObjectURL(f)},$e=async()=>{var t,e;E.value=!0;try{const o={status:r.status||void 0,ownerUsername:((t=r.ownerUsername)==null?void 0:t.trim())||void 0,submitterUsername:((e=r.submitterUsername)==null?void 0:e.trim())||void 0};Array.isArray(r.dateRange)&&r.dateRange.length===2&&(o.startDate=r.dateRange[0],o.endDate=r.dateRange[1]),await me(o)}finally{E.value=!1}},ze=async()=>{try{await O.confirm("导出后会删除已确认的数据，确定继续吗？","二次确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"})}catch{return}E.value=!0;try{const t={status:"CONFIRMED"},e=new Date,o=e.getMonth()+1,s=e.getDate(),f=`${o}月${s}日.xlsx`;await me(t,f);const u=await at();console.log(`已从数据库删除 ${u} 条已确认的记录`),p.success(`已导出并删除 ${u} 条已确认记录`),v()}catch(t){console.error("导出或删除失败:",t),p.error("导出或删除操作失败")}finally{E.value=!1}},Le=t=>t?t.replace("T"," ").replace("Z",""):"-",M=(t,e)=>{try{const o={tracking:{bg:t.trackingBgColor,fg:t.trackingFontColor,strike:t.trackingStrike},model:{bg:t.modelBgColor,fg:t.modelFontColor,strike:t.modelStrike},sn:{bg:t.snBgColor,fg:t.snFontColor,strike:t.snStrike},amount:{bg:t.amountBgColor,fg:t.amountFontColor,strike:t.amountStrike},remark:{bg:t.remarkBgColor,fg:t.remarkFontColor,strike:t.remarkStrike}}[e];if(!o)return{};const s={};return o.bg&&o.bg!=="#FFFFFF"&&o.bg!=="#FFF"&&String(o.bg).trim()!==""&&(s["background-color"]=o.bg),o.fg&&o.fg!=="#000000"&&o.fg!=="#000"&&String(o.fg).trim()!==""&&(s.color=o.fg),(o.strike===!0||o.strike==="true"||o.strike===1)&&(s["text-decoration"]="line-through"),s}catch(o){return console.warn("样式应用失败:",o),{}}};be(ee,t=>{re(),oe()},{immediate:!0}),ut(()=>{re(),oe()});const je=async()=>{try{await O.confirm("这将根据当前筛选条件，确认所有待结账的记录（仅处理有金额的条目）。此操作不可撤销，确定继续吗？","确认全部操作",{confirmButtonText:"确定确认",cancelButtonText:"取消",type:"warning"})}catch{return}R.value=!0;try{const t={...K.value,status:"PENDING"};delete t.page,delete t.size;const e=await ot(t);p.success(`操作成功，已确认 ${e} 条记录。`),v()}catch(t){console.error("确认全部失败:",t)}finally{R.value=!1}};return v(),(t,e)=>{const o=b("el-button"),s=b("el-option"),f=b("el-select"),u=b("el-form-item"),V=b("el-input"),x=b("el-date-picker"),I=b("el-form"),pe=b("el-card"),w=b("el-table-column"),T=b("el-input-number"),Ge=b("el-tag"),Ye=b("el-table"),qe=b("el-pagination"),A=b("el-dialog"),fe=b("el-radio-button"),Ze=b("el-radio-group"),Je=b("el-alert"),Ke=ft("loading");return S(),D("div",gt,[C("div",bt,[e[34]||(e[34]=C("div",null,[C("h2",null,"结账管理"),C("p",{class:"sub"},"生成、确认与导出待结账记录")],-1)),C("div",vt,[a(o,{type:"primary",plain:"",onClick:he},{default:n(()=>[...e[26]||(e[26]=[m("批量设置价格",-1)])]),_:1}),a(o,{type:"success",plain:"",onClick:ze},{default:n(()=>[...e[27]||(e[27]=[m(" 导出已确认数据 ",-1)])]),_:1}),a(o,{type:"primary",plain:"",onClick:Te},{default:n(()=>[...e[28]||(e[28]=[m("SN批量设置价格",-1)])]),_:1}),a(o,{type:"success",plain:"",disabled:!c.value.length,onClick:Re},{default:n(()=>[...e[29]||(e[29]=[m("批量确认",-1)])]),_:1},8,["disabled"]),a(o,{type:"warning",plain:"",onClick:je},{default:n(()=>[...e[30]||(e[30]=[m("确认全部",-1)])]),_:1}),a(o,{onClick:$e,loading:E.value},{default:n(()=>[...e[31]||(e[31]=[m("导出 Excel",-1)])]),_:1},8,["loading"]),a(o,{type:"info",plain:"",disabled:!c.value.length,onClick:Be},{default:n(()=>[...e[32]||(e[32]=[m(" 移动到待结账 ",-1)])]),_:1},8,["disabled"]),a(o,{type:"danger",plain:"",disabled:!c.value.length,onClick:Fe},{default:n(()=>[...e[33]||(e[33]=[m(" 删除所选 ",-1)])]),_:1},8,["disabled"])])]),a(pe,null,{default:n(()=>[a(I,{inline:!0,model:r,class:"filter-form"},{default:n(()=>[a(u,{label:"状态"},{default:n(()=>[a(f,{modelValue:r.status,"onUpdate:modelValue":e[0]||(e[0]=l=>r.status=l),clearable:"",placeholder:"全部",style:{width:"160px"}},{default:n(()=>[ee.value?(S(),U(s,{key:0,label:"草稿",value:"DRAFT"})):F("",!0),a(s,{label:"待结账",value:"PENDING"}),a(s,{label:"已确认",value:"CONFIRMED"})]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"单号"},{default:n(()=>[a(V,{modelValue:r.trackingNumber,"onUpdate:modelValue":e[1]||(e[1]=l=>r.trackingNumber=l),placeholder:"输入单号",clearable:"",style:{width:"200px"},onClear:H},null,8,["modelValue"])]),_:1}),a(u,{label:"型号"},{default:n(()=>[a(V,{modelValue:r.model,"onUpdate:modelValue":e[2]||(e[2]=l=>r.model=l),placeholder:"输入型号",clearable:"",style:{width:"200px"},onClear:H},null,8,["modelValue"])]),_:1}),a(u,{label:"SN"},{default:n(()=>[a(V,{modelValue:r.orderSn,"onUpdate:modelValue":e[3]||(e[3]=l=>r.orderSn=l),placeholder:"输入 SN",clearable:"",style:{width:"200px"},onClear:H},null,8,["modelValue"])]),_:1}),a(u,{label:"日期"},{default:n(()=>[a(x,{modelValue:r.dateRange,"onUpdate:modelValue":e[4]||(e[4]=l=>r.dateRange=l),type:"daterange","value-format":"YYYY-MM-DD","start-placeholder":"开始","end-placeholder":"结束"},null,8,["modelValue"])]),_:1}),a(u,{label:"归属用户"},{default:n(()=>[a(f,{modelValue:r.ownerUsername,"onUpdate:modelValue":e[5]||(e[5]=l=>r.ownerUsername=l),placeholder:"全部",clearable:"",filterable:"",style:{width:"200px"},loading:Z.value},{default:n(()=>[(S(!0),D($,null,X(ae.value,l=>(S(),U(s,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),a(u,{label:"提交人"},{default:n(()=>[a(f,{modelValue:r.submitterUsername,"onUpdate:modelValue":e[6]||(e[6]=l=>r.submitterUsername=l),placeholder:"全部",clearable:"",filterable:"",style:{width:"200px"},loading:J.value},{default:n(()=>[(S(!0),D($,null,X(ne.value,l=>(S(),U(s,{key:l.username,label:l.fullName?`${l.fullName}（${l.username}）`:l.username,value:l.username},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),a(u,null,{default:n(()=>[a(o,{type:"primary",onClick:v},{default:n(()=>[...e[35]||(e[35]=[m("查询",-1)])]),_:1}),a(o,{onClick:ie},{default:n(()=>[...e[36]||(e[36]=[m("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(pe,{class:"table-card"},{default:n(()=>[pt((S(),U(Ye,{ref_key:"tableRef",ref:j,data:Q.value,height:"520","default-sort":Y,"highlight-current-row":"","current-row":G.value,"row-class-name":Ue,onSelectionChange:Ve,onRowClick:_e,onSortChange:xe},{default:n(()=>[a(w,{type:"selection",width:"48"}),a(w,{prop:"orderTime",label:"下单时间",width:"180",sortable:"custom","sort-orders":["ascending","descending"]},{default:n(({row:l})=>[m(N(Le(l.orderTime)),1)]),_:1}),a(w,{prop:"trackingNumber",label:"单号",width:"260",sortable:"custom","sort-orders":["ascending","descending"]},{default:n(({row:l})=>[C("span",{style:z(M(l,"tracking"))},N(l.trackingNumber),5)]),_:1}),a(w,{prop:"model",label:"型号",width:"400"},{default:n(({row:l})=>[C("span",{style:z(M(l,"model"))},N(l.model||"-"),5)]),_:1}),a(w,{prop:"orderSn",label:"SN",width:"340"},{default:n(({row:l})=>[C("span",{style:z(M(l,"sn"))},N(l.orderSn||"-"),5)]),_:1}),a(w,{prop:"amount",label:"结账金额",width:"180",sortable:"custom","sort-orders":["ascending","descending"]},{default:n(({row:l})=>[a(T,{modelValue:l.amount,"onUpdate:modelValue":B=>l.amount=B,min:0,step:10,size:"small",controls:!1,placeholder:"输入金额确认",style:{width:"100%"},onChange:(B,Qe)=>De(l,B,Qe)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(w,{prop:"ownerUsername",label:"归属人",width:"100"},{default:n(({row:l})=>[m(N(l.ownerUsername||"-"),1)]),_:1}),a(w,{prop:"submitterUsername",label:"提交人",width:"100"},{default:n(({row:l})=>[m(N(l.submitterUsername||"-"),1)]),_:1}),a(w,{prop:"status",label:"状态",width:"100",sortable:"custom","sort-orders":["ascending","descending"]},{default:n(({row:l})=>[a(Ge,{type:l.status==="CONFIRMED"?"success":"warning"},{default:n(()=>[m(N(l.status==="CONFIRMED"?"已确认":"待结账"),1)]),_:2},1032,["type"])]),_:1}),a(w,{prop:"payableAt",label:"应付日期",width:"140"}),a(w,{prop:"remark",label:"备注"},{default:n(({row:l})=>[C("span",{style:z(M(l,"remark"))},N(l.remark||"-"),5)]),_:1}),a(w,{label:"操作",width:"160"},{default:n(({row:l})=>[l.status!=="CONFIRMED"?(S(),U(o,{key:0,link:"",type:"primary",onClick:B=>Ee(l)},{default:n(()=>[...e[37]||(e[37]=[m(" 确认 ",-1)])]),_:1},8,["onClick"])):F("",!0),a(o,{link:"",type:"danger",onClick:B=>Oe(l)},{default:n(()=>[...e[38]||(e[38]=[m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data","current-row"])),[[Ke,R.value]]),a(qe,{"current-page":r.page,"onUpdate:currentPage":e[7]||(e[7]=l=>r.page=l),"page-size":r.size,"onUpdate:pageSize":e[8]||(e[8]=l=>r.size=l),total:L.value,layout:"total, sizes, prev, pager, next","page-sizes":[20,50,100,200],style:{"margin-top":"12px","justify-content":"flex-end"},onSizeChange:we,onCurrentChange:Ce},null,8,["current-page","page-size","total"])]),_:1}),a(A,{modelValue:g.visible,"onUpdate:modelValue":e[12]||(e[12]=l=>g.visible=l),title:"确认结账",width:"480px","destroy-on-close":!0},{footer:n(()=>[a(o,{onClick:e[11]||(e[11]=l=>g.visible=!1)},{default:n(()=>[...e[39]||(e[39]=[m("取消",-1)])]),_:1}),a(o,{type:"primary",loading:g.loading,onClick:Ie},{default:n(()=>[...e[40]||(e[40]=[m("确认",-1)])]),_:1},8,["loading"])]),default:n(()=>[a(I,{"label-width":"100px"},{default:n(()=>[a(u,{label:"金额"},{default:n(()=>[a(T,{modelValue:g.form.amount,"onUpdate:modelValue":e[9]||(e[9]=l=>g.form.amount=l),min:0,step:10,controls:!1,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),a(u,{label:"备注"},{default:n(()=>[a(V,{modelValue:g.form.remark,"onUpdate:modelValue":e[10]||(e[10]=l=>g.form.remark=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:i.visible,"onUpdate:modelValue":e[18]||(e[18]=l=>i.visible=l),title:"批量设置价格",width:"420px","destroy-on-close":!0},{footer:n(()=>[a(o,{onClick:e[17]||(e[17]=l=>i.visible=!1)},{default:n(()=>[...e[43]||(e[43]=[m("取消",-1)])]),_:1}),a(o,{type:"primary",loading:i.loading,onClick:Pe},{default:n(()=>[...e[44]||(e[44]=[m("保存",-1)])]),_:1},8,["loading"])]),default:n(()=>[a(I,{"label-width":"100px"},{default:n(()=>[a(u,{label:"作用范围"},{default:n(()=>[a(Ze,{modelValue:i.form.scope,"onUpdate:modelValue":e[13]||(e[13]=l=>i.form.scope=l)},{default:n(()=>[a(fe,{label:"MODEL"},{default:n(()=>[...e[41]||(e[41]=[m("按型号筛选",-1)])]),_:1}),a(fe,{label:"SELECTION",disabled:!c.value.length},{default:n(()=>[...e[42]||(e[42]=[m("已选择记录",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),i.form.scope==="MODEL"?(S(),D($,{key:0},[a(u,{label:"型号"},{default:n(()=>[a(f,{modelValue:i.form.model,"onUpdate:modelValue":e[14]||(e[14]=l=>i.form.model=l),placeholder:"请选择型号",filterable:"","allow-create":""},{default:n(()=>[(S(!0),D($,null,X(q.value,l=>(S(),U(s,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"状态范围"},{default:n(()=>[a(f,{modelValue:i.form.status,"onUpdate:modelValue":e[15]||(e[15]=l=>i.form.status=l),placeholder:"全部",clearable:"",style:{width:"200px"}},{default:n(()=>[a(s,{label:"待结账",value:"PENDING"}),a(s,{label:"已确认",value:"CONFIRMED"})]),_:1},8,["modelValue"])]),_:1})],64)):F("",!0),a(u,{label:"金额"},{default:n(()=>[a(T,{modelValue:i.form.amount,"onUpdate:modelValue":e[16]||(e[16]=l=>i.form.amount=l),min:0,step:10,controls:!1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:y.visible,"onUpdate:modelValue":e[21]||(e[21]=l=>y.visible=l),title:"批量确认",width:"420px","destroy-on-close":!0},{footer:n(()=>[a(o,{onClick:e[20]||(e[20]=l=>y.visible=!1)},{default:n(()=>[...e[45]||(e[45]=[m("取消",-1)])]),_:1}),a(o,{type:"primary",loading:y.loading,onClick:Me},{default:n(()=>[...e[46]||(e[46]=[m("确认",-1)])]),_:1},8,["loading"])]),default:n(()=>[a(I,{"label-width":"100px"},{default:n(()=>[a(u,{label:"备注"},{default:n(()=>[a(V,{modelValue:y.form.remark,"onUpdate:modelValue":e[19]||(e[19]=l=>y.form.remark=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(A,{modelValue:d.visible,"onUpdate:modelValue":e[25]||(e[25]=l=>d.visible=l),title:"SN批量设置价格",width:"520px","destroy-on-close":!0},{footer:n(()=>[a(o,{onClick:e[24]||(e[24]=l=>d.visible=!1)},{default:n(()=>[...e[48]||(e[48]=[m("取消",-1)])]),_:1}),a(o,{type:"primary",loading:d.loading,onClick:Ae,disabled:d.parsedSns.length===0},{default:n(()=>[...e[49]||(e[49]=[m("保存",-1)])]),_:1},8,["loading","disabled"])]),default:n(()=>[a(I,{"label-width":"100px"},{default:n(()=>[a(u,{label:"SN列表"},{default:n(()=>[a(V,{modelValue:d.form.snInput,"onUpdate:modelValue":e[22]||(e[22]=l=>d.form.snInput=l),type:"textarea",rows:6,placeholder:"支持多个SN，使用换行/逗号/分号分隔"},null,8,["modelValue"]),C("div",yt,[m(" 已识别 "+N(d.parsedSns.length)+" 个SN ",1),d.duplicateSns.length>0?(S(),D("span",kt," (发现 "+N(d.duplicateSns.length)+" 个重复) ",1)):F("",!0)])]),_:1}),a(u,{label:"金额"},{default:n(()=>[a(T,{modelValue:d.form.amount,"onUpdate:modelValue":e[23]||(e[23]=l=>d.form.amount=l),min:0,step:10,controls:!1},null,8,["modelValue"])]),_:1}),d.duplicateSns.length>0?(S(),U(Je,{key:0,type:"warning",closable:!1,style:{"margin-bottom":"12px"}},{title:n(()=>[e[47]||(e[47]=C("div",null,"检测到重复SN，将跳过以下SN：",-1)),C("div",St,N(d.duplicateSns.join("、")),1)]),_:1})):F("",!0)]),_:1})]),_:1},8,["modelValue"])])}}}),_t=ct(wt,[["__scopeId","data-v-af622f81"]]);export{_t as default};
