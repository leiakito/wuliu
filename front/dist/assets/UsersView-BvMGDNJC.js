import{y as v,d as P,r as c,a as z,j as F,c as G,e as g,b as l,w as t,g as u,f as n,v as H,x as J,m as D,t as K,n as Q,E as C,C as x,o as N}from"./index-D4luNJRO.js";const W=()=>v.get("/users"),X=r=>v.post("/users",r),Y=(r,d)=>v.put(`/users/${r}`,d),Z=(r,d)=>v.put(`/users/${r}/password`,{password:d}),h=r=>v.delete(`/users/${r}`),ee={class:"page"},le={class:"page-header"},ae=P({__name:"UsersView",setup(r){const d=c([]),b=c(!1),w=c(!1),m=c(!1),y=c(),a=z({username:"",fullName:"",role:"USER",status:"ENABLED",password:""}),$=F(()=>a.id?"编辑用户":"新增用户"),A={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},V=async()=>{b.value=!0;try{d.value=await W()}finally{b.value=!1}},U=o=>{o?Object.assign(a,o,{password:"",id:o.id}):Object.assign(a,{id:void 0,username:"",fullName:"",role:"USER",status:"ENABLED",password:""}),m.value=!0},M=async()=>{if(!(!y.value||!await y.value.validate().catch(()=>!1))){w.value=!0;try{a.id?await Y(a.id,a):await X(a),C.success("保存成功"),m.value=!1,V()}finally{w.value=!1}}},R=async o=>{const{value:e}=await x.prompt(`为 ${o.username} 设置新密码`,"重置密码",{inputType:"password",confirmButtonText:"确定",cancelButtonText:"取消"});await Z(o.id,e),C.success("密码已重置")},S=async o=>{await x.confirm(`确认删除 ${o.username} ?`,"提示",{type:"warning"}),await h(o.id),C.success("已删除"),V()};return V(),(o,e)=>{const i=n("el-button"),p=n("el-table-column"),T=n("el-tag"),I=n("el-table"),L=n("el-card"),k=n("el-input"),f=n("el-form-item"),_=n("el-option"),E=n("el-select"),j=n("el-form"),q=n("el-dialog"),O=J("loading");return N(),G("div",ee,[g("div",le,[e[9]||(e[9]=g("div",null,[g("h2",null,"用户管理"),g("p",{class:"sub"},"仅管理员可访问，支持增删改及重置密码")],-1)),l(i,{type:"primary",onClick:e[0]||(e[0]=s=>U())},{default:t(()=>[...e[8]||(e[8]=[u("新增用户",-1)])]),_:1})]),l(L,{class:"table-card"},{default:t(()=>[H((N(),D(I,{data:d.value},{default:t(()=>[l(p,{prop:"username",label:"用户名",width:"160"}),l(p,{prop:"fullName",label:"姓名",width:"160"}),l(p,{label:"角色",width:"140"},{default:t(({row:s})=>[l(T,{type:s.role==="ADMIN"?"danger":"info"},{default:t(()=>[u(K(s.role==="ADMIN"?"管理员":"用户"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"status",label:"状态",width:"120"}),l(p,{prop:"createdAt",label:"创建时间"}),l(p,{label:"操作",width:"240"},{default:t(({row:s})=>[l(i,{link:"",type:"primary",onClick:B=>U(s)},{default:t(()=>[...e[10]||(e[10]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(i,{link:"",type:"warning",onClick:B=>R(s)},{default:t(()=>[...e[11]||(e[11]=[u("重置密码",-1)])]),_:1},8,["onClick"]),l(i,{link:"",type:"danger",onClick:B=>S(s)},{default:t(()=>[...e[12]||(e[12]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,b.value]])]),_:1}),l(q,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=s=>m.value=s),title:$.value,width:"520px"},{footer:t(()=>[l(i,{onClick:e[6]||(e[6]=s=>m.value=!1)},{default:t(()=>[...e[13]||(e[13]=[u("取消",-1)])]),_:1}),l(i,{type:"primary",loading:w.value,onClick:M},{default:t(()=>[...e[14]||(e[14]=[u("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(j,{ref_key:"formRef",ref:y,model:a,rules:A,"label-width":"80px"},{default:t(()=>[l(f,{label:"用户名",prop:"username"},{default:t(()=>[l(k,{modelValue:a.username,"onUpdate:modelValue":e[1]||(e[1]=s=>a.username=s),disabled:!!a.id},null,8,["modelValue","disabled"])]),_:1}),l(f,{label:"姓名",prop:"fullName"},{default:t(()=>[l(k,{modelValue:a.fullName,"onUpdate:modelValue":e[2]||(e[2]=s=>a.fullName=s)},null,8,["modelValue"])]),_:1}),l(f,{label:"角色",prop:"role"},{default:t(()=>[l(E,{modelValue:a.role,"onUpdate:modelValue":e[3]||(e[3]=s=>a.role=s)},{default:t(()=>[l(_,{label:"管理员",value:"ADMIN"}),l(_,{label:"用户",value:"USER"})]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"状态",prop:"status"},{default:t(()=>[l(E,{modelValue:a.status,"onUpdate:modelValue":e[4]||(e[4]=s=>a.status=s)},{default:t(()=>[l(_,{label:"启用",value:"ENABLED"}),l(_,{label:"禁用",value:"DISABLED"})]),_:1},8,["modelValue"])]),_:1}),a.id?Q("",!0):(N(),D(f,{key:0,label:"初始密码",prop:"password"},{default:t(()=>[l(k,{modelValue:a.password,"onUpdate:modelValue":e[5]||(e[5]=s=>a.password=s),placeholder:"默认 ChangeMe123!"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{ae as default};
