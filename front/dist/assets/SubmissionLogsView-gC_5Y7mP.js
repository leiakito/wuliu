import{d as I,r as p,a as S,k as z,c as U,e as m,b as a,w as s,g as b,f as r,D as $,G,F as q,s as J,v as K,x as Q,m as D,t as W,E as A,o as w,_ as X}from"./index-xnLysfLr.js";import{c as Z}from"./submissions-CGDh9ZA7.js";import{l as ee}from"./users-B9v59k8P.js";const ae={class:"page"},te={class:"page-header"},le={class:"header-actions"},ne={class:"log-content"},oe=I({__name:"SubmissionLogsView",setup(se){const y=p(!1),k=p(!1),h=p(!1),g=p([]),C=p([]),t=S({username:"",keyword:"",range:[]}),n=S({page:1,size:10,total:0}),_=p(!1),B=()=>{var e,u;const l={page:n.page,size:n.size,username:((e=t.username)==null?void 0:e.trim())||void 0,keyword:((u=t.keyword)==null?void 0:u.trim())||void 0};return Array.isArray(t.range)&&t.range.length===2&&(l.startTime=t.range[0],l.endTime=t.range[1]),l},E=async()=>{k.value=!0;try{const l=await ee();C.value=l.map(e=>e.username)}finally{k.value=!1}},d=async()=>{y.value=!0;try{const l=await Z(B());g.value=l.records,n.total=l.total}catch(l){console.error(l),A.error("加载提交记录失败")}finally{y.value=!1}},O=()=>{_.value=!0,t.username="",t.keyword="",t.range=[],n.page=1,_.value=!1,d()},R=l=>{n.page=l,d()},j=l=>{n.size=l,n.page=1,d()},Y=()=>{d()},F=async()=>{if(!g.value.length){A.warning("暂无数据可导出");return}h.value=!0;try{const l=["提交时间","用户名","原文本"],e=g.value.map(i=>[i.createdAt??"",i.username??"",i.content??""]),u=[l,...e].map(i=>i.map(x=>`"${String(x??"").replace(/"/g,'""')}"`).join(",")).join(`
`),c=new Blob([u],{type:"application/vnd.ms-excel"}),v=window.URL.createObjectURL(c),f=document.createElement("a");f.href=v,f.download=`submission-logs-${new Date().toISOString().slice(0,10)}.xls`,f.click(),window.URL.revokeObjectURL(v)}finally{h.value=!1}};return z(()=>t.username,l=>{_.value||(n.page=1,d())}),z(()=>t.range,()=>{_.value||(n.page=1,d())},{deep:!0}),z(()=>t.keyword,l=>{_.value||(n.page=1,d())}),E(),d(),(l,e)=>{const u=r("el-icon"),c=r("el-button"),v=r("el-option"),f=r("el-select"),i=r("el-form-item"),x=r("el-input"),M=r("el-date-picker"),N=r("el-form"),L=r("el-card"),V=r("el-table-column"),P=r("el-table"),T=r("el-pagination"),H=Q("loading");return w(),U("div",ae,[m("div",te,[e[7]||(e[7]=m("div",null,[m("h2",null,"提交记录"),m("p",{class:"sub"},"查看用户提交的原始文本与时间")],-1)),m("div",le,[a(c,{text:"",onClick:Y},{default:s(()=>[a(u,null,{default:s(()=>[a($(G))]),_:1}),e[5]||(e[5]=b("刷新 ",-1))]),_:1}),a(c,{text:"",loading:h.value,disabled:!g.value.length,onClick:F},{default:s(()=>[...e[6]||(e[6]=[b(" 导出 Excel ",-1)])]),_:1},8,["loading","disabled"])])]),a(L,{class:"filter-card"},{default:s(()=>[a(N,{inline:!0,model:t},{default:s(()=>[a(i,{label:"用户名"},{default:s(()=>[a(f,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=o=>t.username=o),filterable:"",clearable:"",placeholder:"全部用户",style:{width:"200px"},loading:k.value},{default:s(()=>[(w(!0),U(q,null,J(C.value,o=>(w(),D(v,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),a(i,{label:"关键字"},{default:s(()=>[a(x,{modelValue:t.keyword,"onUpdate:modelValue":e[1]||(e[1]=o=>t.keyword=o),placeholder:"搜索原文",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"时间范围"},{default:s(()=>[a(M,{modelValue:t.range,"onUpdate:modelValue":e[2]||(e[2]=o=>t.range=o),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD HH:mm:ss","unlink-panels":""},null,8,["modelValue"])]),_:1}),a(i,null,{default:s(()=>[a(c,{type:"primary",onClick:d},{default:s(()=>[...e[8]||(e[8]=[b("查询",-1)])]),_:1}),a(c,{onClick:O},{default:s(()=>[...e[9]||(e[9]=[b("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(L,{class:"table-card"},{default:s(()=>[K((w(),D(P,{data:g.value},{default:s(()=>[a(V,{prop:"createdAt",label:"提交时间",width:"200"}),a(V,{prop:"username",label:"用户名",width:"160"}),a(V,{label:"原文本"},{default:s(({row:o})=>[m("span",ne,W(o.content),1)]),_:1})]),_:1},8,["data"])),[[H,y.value]]),a(T,{"current-page":n.page,"onUpdate:currentPage":e[3]||(e[3]=o=>n.page=o),"page-size":n.size,"onUpdate:pageSize":e[4]||(e[4]=o=>n.size=o),total:n.total,layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],class:"table-pagination",background:"",onSizeChange:j,onCurrentChange:R},null,8,["current-page","page-size","total"])]),_:1})])}}}),ue=X(oe,[["__scopeId","data-v-5ba90d72"]]);export{ue as default};
