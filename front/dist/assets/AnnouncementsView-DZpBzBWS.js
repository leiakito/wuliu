import{d as P,u as T,j as $,r as m,a as C,z as L,c as y,e as r,v as q,b as s,m as c,n as G,w as l,g as V,x as H,f as i,F as J,s as K,A as O,E as w,B as Q,o as u,t as z,_ as R}from"./index-D4luNJRO.js";const W={class:"page"},X={class:"page-header"},Y={class:"content"},Z={class:"meta"},ee={key:1,class:"empty"},te=P({__name:"AnnouncementsView",setup(ne){const k=T(),A=$(()=>{var a;return((a=k.user)==null?void 0:a.role)==="ADMIN"}),_=m([]),f=m(!1),d=m(!1),g=m(!1),n=C({page:1,size:10,total:0}),o=C({title:"",content:""}),p=async()=>{f.value=!0;try{const a=await O({page:n.page,size:n.size});_.value=a.records,n.total=a.total}finally{f.value=!1}},B=a=>{n.page=a,p()},D=a=>{n.size=a,n.page=1,p()},S=async()=>{if(!o.title||!o.content){w.warning("请填写完整的公告内容");return}g.value=!0;try{await Q(o),w.success("公告已发布"),d.value=!1,o.title="",o.content="",n.page=1,p()}finally{g.value=!1}},M=a=>a.replace("T"," ").slice(0,19);return L(()=>{p()}),(a,e)=>{const v=i("el-button"),N=i("el-timeline-item"),U=i("el-timeline"),h=i("el-pagination"),E=i("el-card"),b=i("el-input"),x=i("el-form-item"),j=i("el-form"),F=i("el-dialog"),I=H("loading");return u(),y("div",W,[r("div",X,[e[8]||(e[8]=r("div",null,[r("h2",null,"系统公告"),r("p",{class:"sub"},"查看管理员发布的最新通知")],-1)),A.value?(u(),c(v,{key:0,type:"primary",onClick:e[0]||(e[0]=t=>d.value=!0)},{default:l(()=>[...e[7]||(e[7]=[V("发布公告",-1)])]),_:1})):G("",!0)]),q((u(),c(E,{class:"table-card"},{default:l(()=>[_.value.length?(u(),c(U,{key:0},{default:l(()=>[(u(!0),y(J,null,K(_.value,t=>(u(),c(N,{key:t.id,timestamp:M(t.createdAt)},{default:l(()=>[r("h3",null,z(t.title),1),r("p",Y,z(t.content),1),r("small",Z,"发布人："+z(t.createdBy??"系统"),1)]),_:2},1032,["timestamp"]))),128))]),_:1})):(u(),y("div",ee,"暂无公告")),s(h,{"current-page":n.page,"onUpdate:currentPage":e[1]||(e[1]=t=>n.page=t),"page-size":n.size,"onUpdate:pageSize":e[2]||(e[2]=t=>n.size=t),total:n.total,layout:"total, sizes, prev, pager, next","page-sizes":[5,10,20],style:{"margin-top":"12px","justify-content":"flex-end"},onSizeChange:D,onCurrentChange:B},null,8,["current-page","page-size","total"])]),_:1})),[[I,f.value]]),s(F,{modelValue:d.value,"onUpdate:modelValue":e[6]||(e[6]=t=>d.value=t),title:"发布公告",width:"520px"},{footer:l(()=>[s(v,{onClick:e[5]||(e[5]=t=>d.value=!1)},{default:l(()=>[...e[9]||(e[9]=[V("取消",-1)])]),_:1}),s(v,{type:"primary",loading:g.value,onClick:S},{default:l(()=>[...e[10]||(e[10]=[V("发布",-1)])]),_:1},8,["loading"])]),default:l(()=>[s(j,{model:o,"label-width":"80px"},{default:l(()=>[s(x,{label:"标题"},{default:l(()=>[s(b,{modelValue:o.title,"onUpdate:modelValue":e[3]||(e[3]=t=>o.title=t),modelModifiers:{trim:!0},placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),s(x,{label:"内容"},{default:l(()=>[s(b,{modelValue:o.content,"onUpdate:modelValue":e[4]||(e[4]=t=>o.content=t),modelModifiers:{trim:!0},type:"textarea",rows:6,placeholder:"请输入公告内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),le=R(te,[["__scopeId","data-v-feb77b41"]]);export{le as default};
